/*1462397336,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["EeErm"]); }

__d("MessagingRealtimeConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={VIEWER_FBID:"realtime_viewer_fbid"};},null);
__d('CanvasNavigationSlider',['Event','XGamesNavigationSliderAsyncController','AsyncRequest','DataStore'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='GamesNavigationSlider';i.init=function(j,k){'use strict';return new i(j,k);};function i(j,k){'use strict';this.$CanvasNavigationSlider1=k.autoscroll;this.$CanvasNavigationSlider2=j;this.$CanvasNavigationSlider3=k.referral_objects;this.$CanvasNavigationSlider4=j.getNode().id;this.$CanvasNavigationSlider5=k.height;this.$CanvasNavigationSlider6=k.width;this.$CanvasNavigationSlider7=k.num_items_per_page;this.$CanvasNavigationSlider8=k.num_rows;this.$CanvasNavigationSlider9=false;c('DataStore').set(h,this.$CanvasNavigationSlider4,this);if(j.getIndex()>0||this.$CanvasNavigationSlider1)this.$CanvasNavigationSlider10();var l=c('Event').listen(j.getNextArrow(),'click',function(){l.remove();this.$CanvasNavigationSlider10();}.bind(this).bind(this));}i.prototype.$CanvasNavigationSlider10=function(){'use strict';if(this.$CanvasNavigationSlider9)return;this.$CanvasNavigationSlider9=true;var j=c('XGamesNavigationSliderAsyncController').getURIBuilder().setStringVector('referral_objects',this.$CanvasNavigationSlider3).setString('id',this.$CanvasNavigationSlider4).setInt('num_items_per_page',this.$CanvasNavigationSlider7).setInt('num_rows',this.$CanvasNavigationSlider8).setInt('width',this.$CanvasNavigationSlider6).setInt('height',this.$CanvasNavigationSlider5).getURI();new (c('AsyncRequest'))(j).send();};i.prototype.$CanvasNavigationSlider11=function(j){'use strict';j.forEach(function(k){this.$CanvasNavigationSlider2.push(k);}.bind(this));};i.update=function(j,k){'use strict';var l=c('DataStore').get(h,j);l.$CanvasNavigationSlider11(k);};f.exports=i;},null);
__d('AjaxRequest',['ErrorUtils','Keys','PHPQuerySerializer','TimeSlice','URI','UserAgent_DEPRECATED','getSameOriginTransport','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(l,m,n){this.xhr=c('getSameOriginTransport')();if(!(m instanceof c('URI')))m=new (c('URI'))(m);if(n&&l=='GET'){m.setQueryData(n);}else this._params=n;this.method=l;this.uri=m;this.xhr.open(l,m);}var i=window.XMLHttpRequest&&'withCredentials' in new XMLHttpRequest();h.supportsCORS=function(){return i;};h.ERROR='ar:error';h.TIMEOUT='ar:timeout';h.PROXY_ERROR='ar:proxy error';h.TRANSPORT_ERROR='ar:transport error';h.SERVER_ERROR='ar:http error';h.PARSE_ERROR='ar:parse error';h.SERVICE_UNAVAILABLE='ar:noservice';h._inflight=[];function j(){var l=h._inflight;h._inflight=[];l.forEach(function(m){m.abort();});}function k(l){l.onJSON=l.onError=l.onSuccess=null;clearTimeout(l._timer);if(l.xhr&&l.xhr.readyState<4){l.xhr.abort();l.xhr=null;}h._inflight=h._inflight.filter(function(m){return m&&m!=l&&m.xhr&&m.xhr.readyState<4;});}Object.assign(h.prototype,{timeout:60000,streamMode:true,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function(l){if(this[l])this[l](this);},_parseStatus:function(){var l;try{this.status=this.xhr.status;l=this.xhr.statusText;}catch(m){if(this.xhr.readyState>=4){this.errorType=h.TRANSPORT_ERROR;this.errorText=m.message;}return;}if(this.status===0&&!/^(file|ftp)/.test(this.uri)){this.errorType=h.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=h.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=h.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=h.SERVER_ERROR;}else if(this.status===503){this.errorType=h.SERVICE_UNAVAILABLE;}else if(this.status>500&&this.status<600){this.errorType=h.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=h.TRANSPORT_ERROR;}else{l='unrecognized status code: '+this.status;this.errorType=h.ERROR;}if(!this.errorText)this.errorText=l;},_parseResponse:function(){var l,m=this.xhr.readyState;try{l=this.xhr.responseText||'';}catch(n){if(m>=4){this.errorType=h.ERROR;this.errorText='responseText not available - '+n.message;}return;}while(this.xhr){var o=this._eol+1,p=this.streamMode?l.indexOf('\n',o):l.length;if(p<0&&m==4)p=l.length;if(p<=this._eol)break;var q=l;if(this.streamMode)q=l.substr(o,p-o).replace(/^\s*|\s*$/g,'');if(o===0&&this.prelude)if(this.prelude.test(q))q=q.replace(this.prelude,'');this._eol=p;if(q){try{this.json=JSON.parse(q);}catch(n){var r=/(<body[\S\s]+?<\/body>)/i.test(l)&&RegExp.$1,s={message:n.message,'char':o,excerpt:(o===0&&r||q).substr(512)};this.errorType=h.PARSE_ERROR;this.errorText='parse error - '+JSON.stringify(s);return;}c('ErrorUtils').applyWithGuard(this._call,this,['onJSON']);}}},_onReadyState:function(){var l=this.xhr&&this.xhr.readyState||0;if(this.status==null&&l>=2)this._parseStatus();if(!this.errorType&&this.status!=null)if(l==3&&this.streamMode||l==4)this._parseResponse();if(this.errorType||l==4){this._time=Date.now()-this._sentAt;this._call(!this.errorType?'onSuccess':'onError');k(this);}},send:function(l){this.xhr.onreadystatechange=c('TimeSlice').guard(this._onReadyState.bind(this),'AjaxRequest xhr.onreadystatechange');var m=this.timeout;if(m)this._timer=c('setTimeoutAcrossTransitions')(function(){this.errorType=h.TIMEOUT;this.errorText='timeout';this._time=Date.now()-this._sentAt;this._call('onError');k(this);}.bind(this),m);h._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this._sentAt=Date.now();this.xhr.send(l?c('PHPQuerySerializer').serialize(l):'');},abort:function(){k(this);},toString:function(){var l='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)l+=' errorType='+this.errorType+' ('+this.errorText+')';return l+']';},toJSON:function(){var l={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};if(this.errorType)l.uri=this.uri;for(var m in l)if(l[m]==null)delete l[m];return l;}});if(window.addEventListener&&c('UserAgent_DEPRECATED').firefox())window.addEventListener('keydown',function(event){if(event.keyCode===c('Keys').ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',j);f.exports=h;},null);
__d('ChannelSubdomain',['Event','JSLogger','Run','LogHistory','setTimeoutAcrossTransitions','WebStorage'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('channel'),i=c('JSLogger').create('channel'),j='channel_sub:',k=7,l=100*1000,m=null,n;function o(){var q=c('WebStorage').getLocalStorage();if(n){clearTimeout(n);n=null;}if(q&&m!=null)q.removeItem(j+m);m=null;}function p(q,r,s){var t=(q-1)*k;if(s){if(n)clearTimeout(n);m=n=null;}if(r==null)r=Math.floor(Math.random()*t);if(m==null){var u,v,w,x,y,z,aa;(function(){var ba=c('WebStorage').getLocalStorage();if(ba){u=[];for(v=0;v<ba.length;v++){w=ba.key(v);if(w.indexOf(j)===0){x=parseInt(w.substr(j.length),10);u[x]=parseInt(ba.getItem(w),10);}}y=Date.now()-l;for(v=0;v<t;v++){z=(v+r)%t;if(!u[z]||u[z]<y){m=z;break;}}if(m!=null){aa=function(){try{ba.setItem(j+m,Date.now());}catch(ca){h.warn('subdomain set failed',ca.message);}n=c('setTimeoutAcrossTransitions')(aa,l/2);};aa();}else{h.warn('no channel subdomain',u);i.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){c('Event').listen(window,'pagehide',o);}else c('Run').onUnload(o);}else m=r;})();}return m==null?null:m%k;}f.exports={allocate:p,clear:o};},null);
__d('DocRPC',['ErrorUtils'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={_apis:{},_dispatch:function(i){var j;try{i=JSON.parse(i);}catch(k){throw new Error('DocRPC unparsable dispatch: "'+i+'"');}if(h._apis.hasOwnProperty(i.api)){var l=h._apis[i.api];if(l[i.method])j=c('ErrorUtils').applyWithGuard(l[i.method],l,i.args);}if(j===undefined)j=null;return JSON.stringify(j);},publish:function(i,j){h._apis[j]=i;},proxy:function(i,j,k){var l={};k.forEach(function(m){l[m]=function(){var n={api:j,method:m,args:Array.prototype.slice.call(arguments)},o;try{if(i.closed)throw new Error('DocRPC window closed');o=i.DocRPC._dispatch(JSON.stringify(n));}catch(p){c('ErrorUtils').reportError(p);return;}if(typeof o=='string')try{o=JSON.parse(o);}catch(p){throw new Error('DocRPC '+j+'.'+m+' unparsable return: "'+o+'"');}return o;};});return l;}};f.exports=b.DocRPC=h;},null);
__d('ChannelTransport',['AjaxRequest','ChannelConstants','DocRPC','LogHistory','TimeSlice','URI','bind','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('channel');function i(){return (1048576*Math.random()|0).toString(36);}function j(t,u){var v=t.subdomain;v=v===null?'':v+'-';var w=t.host;w=w===null||w===undefined?'edge-chat':t.host;var x=new (c('URI'))(u).setDomain(v+w+'.'+t.domain).setPort(t.port).setSecure(new (c('URI'))(window.location.href).isSecure());return x;}function k(t){var u={partition:t.partition,cb:i(),failure:t.pingFailuresOnSubdomain};if(t.sticky_token)u.sticky_token=t.sticky_token;if(t.sticky_pool)u.sticky_pool=t.sticky_pool;var v=j(t,'/p').setQueryData(u);h.log('start_p',{uri:v.toString()});var w=new (c('AjaxRequest'))('GET',v);if(c('AjaxRequest').supportsCORS())w.xhr.withCredentials=true;var x=function(y){h.log('finish_p',{xhr:y.toJSON?y.toJSON():y,subdomain:t.subdomain,fullHost:t.fullHost});};w.onError=function(y){x(y);if(t.subdomain===null)return;t.pingFailuresOnSubdomain++;t.subdomain++;if(t.subdomain>6)t.subdomain=0;};w.timeout=t.P_TIMEOUT;w.onSuccess=x;w.send();}function l(t,u,v){var w=new Image(),x=0,y=function(ba){w.abort();return ba?u():v();};w.onload=c('TimeSlice').guard(function(){h.log('ping_ok',{duration:Date.now()-x});y(true);},'ChannelTransport image.onload');w.onerror=c('TimeSlice').guard(function(){k(t);y(false);},'ChannelTransport image.onerror');var z=c('setTimeoutAcrossTransitions')(w.onerror,10000);w.abort=function(){if(z){clearTimeout(z);z=null;}w.onload=w.onerror=null;};var aa={partition:t.partition,cb:i()};if(t.sticky_token)aa.sticky_token=t.sticky_token;if(t.sticky_pool)aa.sticky_pool=t.sticky_pool;if(t.lastRequestErrorReason){aa.reason=t.lastRequestErrorReason;t.lastRequestErrorReason=null;}if(t.uid&&t.viewerUid){aa.uid=t.uid;aa.viewer_uid=t.viewerUid;}x=Date.now();w.src=j(t,'/ping').setQueryData(aa);return w;}function m(t,u){var v={channel:t.user_channel,partition:t.partition,clientid:t.sessionID,cb:i(),cap:0,uid:t.uid,viewer_uid:t.viewerUid};if(t.sticky_token)v.sticky_token=t.sticky_token;if(t.sticky_pool)v.sticky_pool=t.sticky_pool;if(t.profile)v.profile=t.profile;if(t.capabilities)v.cap=t.capabilities;v.id=u;var w=j(t,'/add_bud').setQueryData(v),x=new (c('AjaxRequest'))('GET',w);if(c('AjaxRequest').supportsCORS())x.xhr.withCredentials=true;x.onError=function(y){h.warn('add_buddy_error');};x.onSuccess=function(y){h.log('add_buddy_ok');};x.timeout=t.P_TIMEOUT;x.send();}function n(t){var u={channel:t.user_channel,partition:t.partition,clientid:t.sessionID,cb:i(),cap:0,uid:t.uid,viewer_uid:t.viewerUid};if(t.sticky_token)u.sticky_token=t.sticky_token;if(t.sticky_pool)u.sticky_pool=t.sticky_pool;if(t.is_offline||t.shouldSuppressPresence){u.state='offline';}else u.state='active';if(u.state===t.lastPresenceState)return;t.lastPresenceState=u.state;if(t.profile)u.profile=t.profile;if(t.capabilities)u.cap=t.capabilities;var v=j(t,'/active_ping').setQueryData(u),w=new (c('AjaxRequest'))('GET',v);if(c('AjaxRequest').supportsCORS())w.xhr.withCredentials=true;w.onError=function(x){h.warn('active_ping_error');};w.onSuccess=function(x){h.log('active_ping_ok');};w.timeout=t.P_TIMEOUT;w.send();}function o(t,u,v,w){var x=new Date(),y=-1;if(t.userActive>0){y=(x-t.userActive)/1000|0;if(y<0)h.warn('idle_regression',{idleTime:y,now:x.getTime(),userActive:t.userActive});}var z={channel:t.user_channel,seq:t.seq,partition:t.partition,clientid:t.sessionID,cb:i(),idle:y,qp:'y',cap:0};if(t.state.aiq)z.aiq=t.state.aiq;if(t.ready)if(t.seqTurSentAt==-1||t.seqTurSentAt==t.seq){z.tur=t.timeUntilReady;z.qpmade=t.queueMade;t.seqTurSentAt=t.seq;}z.pws=t.pws;if(t.sequenceId>0)z.isq=t.sequenceId;z.msgs_recv=t.estimatedReceived;if(t.uid&&t.viewerUid){z.uid=t.uid;z.viewer_uid=t.viewerUid;}if(t.sticky_token){z.sticky_token=t.sticky_token;}else{z.request_batch=1;if(t.msgr_region)z.msgr_region=t.msgr_region;}if(t.sticky_pool)z.sticky_pool=t.sticky_pool;if('trace_id' in t)z.traceid=t.trace_id;if(t.is_offline||t.shouldSuppressPresence){z.state='offline';}else if(t.userActive>0&&y<60)z.state='active';t.lastPresenceState=z.state;if(t.streamingCapable){z.mode='stream';z.format='json';}if(t.profile)z.profile=t.profile;if(t.capabilities)z.cap=t.capabilities;var aa=j(t,'/pull').setQueryData(z),ba='GET',ca=new (c('AjaxRequest'))(ba,aa);if(c('AjaxRequest').supportsCORS())ca.xhr.withCredentials=true;ca.timeout=t.streamingCapable?t.STREAMING_TIMEOUT:t.LONGPOLL_TIMEOUT;ca.onJSON=u;ca.onSuccess=v;ca.onError=function(){var da=this.status==12002&&this._time>=t.MIN_12002_TIMEOUT||this.status==504&&this._time>=t.MIN_504_TIMEOUT,ea=da?v:w;return ea&&ea.apply(this,arguments);};ca.send();t.inStreaming=t.streamingCapable;return ca;}function p(t){this.manager=t;this.init&&this.init();}function q(t){p.apply(this,arguments);}Object.assign(q.prototype,{logName:'CORS',enterState:function(t,u){if(this._request){this._request.abort();this._request=null;}if(t=='init')c('setTimeoutAcrossTransitions')(c('bind')(this.manager,'exitState',{status:c('ChannelConstants').OK,stateId:u.stateId}),0);if(!/pull|ping/.test(t))return;var v=this.manager;if(t=='ping'){this._request=l(u,c('bind')(v,'exitState',{status:c('ChannelConstants').OK,stateId:u.stateId}),c('bind')(v,'exitState',{status:c('ChannelConstants').ERROR,stateId:u.stateId}));}else if(t=='pull')this._request=o(u,c('bind')(v,'_processTransportData',u.stateId),c('bind')(v,'exitState',{status:c('ChannelConstants').OK,stateId:u.stateId}),c('bind')(v,'exitState',{status:c('ChannelConstants').ERROR,stateId:u.stateId}));}});function r(t){h.log('iframe_init_constructor');p.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);c('DocRPC').publish(this,'outerTransport');}Object.assign(r.prototype,{logName:'iframe',_initIframe:function(t){h.log('iframe_init_start');window.onchanneliframeready=function(){h.log('iframe_resources');return t.resources;};window.onchanneliframeloaded=function(){h.log('iframe_loaded');};if(t){this._iframeURI=j(t,t.path);if(t.resources){var u=this._iframeURI.getDomain();t.resources=t.resources.map(function(w){var x=new (c('URI'))(w);if(x.getPath().startsWith('/intern/rsrc.php')&&x.getQueryData().origin!==undefined)return x.addQueryData('origin',u).toString();return w;});}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);h.log('iframe_uri_set');}catch(v){h.error('iframe_uri_set_error',v);this.exitState({status:c('ChannelConstants').ERROR,stateId:t.stateId},v+'');}},enterState:function(t,u){if(t=='init'){this._initIframe(u);}else if(/idle|ping|pull/.test(t)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(t!='idle')this.exitState({status:c('ChannelConstants').ERROR,stateId:u.stateId},'iframe not yet loaded');}else if(t=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(t){if(this.manager.state=='init'&&t.status==c('ChannelConstants').OK)this._iframeProxy=c('DocRPC').proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function s(){this.init=this.init.bind(this);p.apply(this,arguments);}Object.assign(s.prototype,{logName:'iframe(inner)',init:function(){c('DocRPC').publish(this,'innerTransport');try{var u=c('DocRPC').proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);Object.assign(this,u);this.exitState({status:c('ChannelConstants').OK,stateId:1e+06});}catch(t){h.error('iframe_inner_init_error',t);}},enterState:function(t,u){if(this._request){this._request.abort();this._request=null;}if(t=='ping'){this._request=l(u,c('bind')(this,'exitState',{status:c('ChannelConstants').OK,stateId:u.stateId}),c('bind')(this,'exitState',{status:c('ChannelConstants').ERROR,stateId:u.stateId}));}else if(t=='pull')this._request=o(u,c('bind')(this,'_processTransportData',u.stateId),c('bind')(this,'exitState',{status:c('ChannelConstants').OK,stateId:u.stateId}),c('bind')(this,'exitState',{status:c('ChannelConstants').ERROR,stateId:u.stateId}));}});f.exports={getURI:j,Transport:p,CORSTransport:q,IframeTransport:r,IframeInnerTransport:s,sendActivePing:n,sendAdditionalBuddyRequest:m};},null);
__d('ChatProxyConnectionState',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.auxiliaryIrisQueues={};this.aiq=null;}h.prototype.subscribeIrisQueue=function(i,j){this.auxiliaryIrisQueues[i]=j;this.updateCaches();};h.prototype.unsubscribeIrisQueue=function(i){delete this.auxiliaryIrisQueues[i];this.updateCaches();};h.prototype.updateCaches=function(){var i=[];for(var j in this.auxiliaryIrisQueues)if(this.auxiliaryIrisQueues.hasOwnProperty(j)){i.push(j);i.push(this.auxiliaryIrisQueues[j]);}if(i.length===0){this.aiq=null;}else this.aiq=i.join(',');};f.exports=h;},null);
__d('FBAjaxRequest',['AjaxRequest','getAsyncParams'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k){k=babelHelpers['extends']({},c('getAsyncParams')(i),k);var l=new (c('AjaxRequest'))(i,j,k);l.streamMode=false;var m=l._call;l._call=function(n){if(n=='onJSON'&&this.json){if(this.json.error){this.errorType=c('AjaxRequest').SERVER_ERROR;this.errorText='AsyncResponse error: '+this.json.error;}this.json=this.json.payload;}m.apply(this,arguments);};l.ajaxReqSend=l.send;l.send=function(n){this.ajaxReqSend(babelHelpers['extends']({},n,k));};return l;}f.exports=h;},null);
__d('FantailLogger',['FantailConfig'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('FantailConfig').FantailLogQueue,i={debug:function(j,k){var l;for(var m=arguments.length,n=Array(m>2?m-2:0),o=2;o<m;o++)n[o-2]=arguments[o];h&&(l=h.get(j)).debug.apply(l,[k].concat(n));},info:function(j,k){var l;for(var m=arguments.length,n=Array(m>2?m-2:0),o=2;o<m;o++)n[o-2]=arguments[o];h&&(l=h.get(j)).info.apply(l,[k].concat(n));},warn:function(j,k){var l;for(var m=arguments.length,n=Array(m>2?m-2:0),o=2;o<m;o++)n[o-2]=arguments[o];h&&(l=h.get(j)).warn.apply(l,[k].concat(n));},error:function(j,k){var l;for(var m=arguments.length,n=Array(m>2?m-2:0),o=2;o<m;o++)n[o-2]=arguments[o];h&&(l=h.get(j)).error.apply(l,[k].concat(n));}};f.exports=i;},null);
__d("MovingStat",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){i=i||60000;var j={t:new Date(),count:0,v:0},k=j,l=0,m=0;function n(){var o=new Date()-i;while(k&&k.next&&k.t<o){l-=k.v;m-=k.count;k=k.next;}}this.add=function(o){l+=o;m++;var p=new Date();if(p-j.t<1000){j.v+=o;j.count++;}else{j.next={t:p,v:o,count:1};j=j.next;n();}};this.tally=function(o){o=o||1000;n();return {sum:l,count:m,timeAverage:l*o/i};};}f.exports=h;},null);
__d('RTISession',['invariant','URI','AjaxRequest','ErrorUtils'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i='.facebook.com';function j(k,l,m,n,o,p,q,r,s){!k?h(0):void 0;!n?h(0):void 0;!o?h(0):void 0;this.domain=k;this.port=l;this.edgePoolName=m;this.stickyToken=n;this.loggedInId=o;this.accountId=p;this.clientProfile=q||'desktop';this.clientId=r;this.capabilities=s;}j.prototype.issueRequest=function(k,l,m,n,o){!k?h(0):void 0;!l?h(0):void 0;!n?h(0):void 0;var p=this.domain.length-i.length,q=p>0&&this.domain.indexOf(i,p)!==-1,r=q?this.domain:this.domain+i,s=(1048576*Math.random()|0).toString(36),t={cb:s,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var u in t)!!l[u]?h(0):void 0;Object.assign(t,l);var v=new (c('URI'))(k).setDomain(r).setPort(this.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(t),w=m?'POST':'GET',x=new (c('AjaxRequest'))(w,v);x.timeout=o?o*1000:30000;if(x.xhr)x.xhr.withCredentials=true;var y={};x.onSuccess=function(){};x.onJSON=function(){y.data=x.json;y.error=null;c('ErrorUtils').applyWithGuard(n,this,[y]);}.bind(this);x.onError=function(){y.data=null;y.error=x.errorType||'error';c('ErrorUtils').applyWithGuard(n,this,[y]);}.bind(this);x.send(JSON.stringify(m));};f.exports=j;},null);
__d('ChannelManager',['errorCode','Promise','AjaxRequest','Arbiter','AsyncRequest','ChannelClientID','ChannelConstants','ChannelInitialData','ChannelSubdomain','ChannelTransport','ChatVisibility','ChatReliabilityInstrumentation','DTSG','Env','FantailLogger','FBAjaxRequest','FBRTCSupport','ISB','JSLogger','LogHistory','MessagingRealtimeConstants','MovingStat','PresenceCookieManager','PresenceState','PresenceUtil','RTISession','SystemEvents','URI','UserActivity','ChatProxyConnectionState','emptyFunction','requestAnimationFrameAcrossTransitions','setIntervalAcrossTransitions','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i,j=c('JSLogger').create('channel'),k=c('LogHistory').getInstance('channel_manager'),l=null,m=c('emptyFunction'),n=new (c('Promise'))(function(ba,ca){m=ba;});function o(ba){l=ba;}var p={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},q={state:new (c('ChatProxyConnectionState'))(),userActive:Date.now(),created:Date.now(),ready:false,seqTurSentAt:-1,queueMade:'',sequenceId:0,lastPresenceState:null,lastRequestErrorReason:null,seq:0,pingFailuresOnSubdomain:0,pws:'fresh',estimatedReceived:0,sessionID:c('ChannelClientID').getID(),capabilities:c('FBRTCSupport').getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:c('PresenceState').shouldSuppress(),LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false},r=1,s={},t=0;function u(){return c('AsyncRequest').lastSuccessTime?Math.round((Date.now()-c('AsyncRequest').lastSuccessTime)/1000):-1;}function v(){var ba={};if(i.getConfig('host'))ba[i.getConfig('user_channel')]=i.getConfig('seq',0);return ba;}function w(){var ba=Date.now(),ca=Date.now(),da={total:0},ea='idle',fa=false;c('SystemEvents').subscribe([c('SystemEvents').USER,c('SystemEvents').ONLINE,c('SystemEvents').TIME_TRAVEL],function(ia,ja){y(true);ca=null;i.lastPullTime=Date.now();var ka;switch(ia){case c('SystemEvents').USER:ka=c('SystemEvents').isPageOwner()?c('ChannelConstants').SYS_OWNER:c('ChannelConstants').SYS_NONOWNER;break;case c('SystemEvents').ONLINE:ka=ja?c('ChannelConstants').SYS_ONLINE:c('ChannelConstants').SYS_OFFLINE;break;case c('SystemEvents').TIME_TRAVEL:if(0<ja&&ja<180000&&q.reduceTimeTravel){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'skipping time travel failure. %d',ja);return;}ka=c('ChannelConstants').SYS_TIMETRAVEL;break;}i.exitState({status:ka,stateId:r});});var ga=function(ia,ja){var ka=Date.now(),la=null;if(ja){ba=ka;la=ja.nextState||ja.state;}else la=ea;c('SystemEvents').checkTimeTravel();if(ca){var ma=Math.round((ka-ca)/1000);if(ma>0){da[ea]=(da[ea]||0)+ma;da.total+=ma;}}ea=la;ca=ka;if(!ia){da.lastSuccessTime=u();da.online=c('SystemEvents').isOnline();k.log('rollup',JSON.stringify(da));}};c('Arbiter').subscribe(c('ChannelConstants').ON_ENTER_STATE,ga);c('setIntervalAcrossTransitions')(ga,60000);c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(ia,ja){ja.channelRollup=da;});var ha=function(){if(i.isShutdown()||i.shouldIdle())return;c('SystemEvents').checkTimeTravel();var ia=Date.now()-(i.lastPullTime||c('Env').start);if(!fa&&ia>q.STALL_THRESHOLD){var ja=u();k.error('stall',JSON.stringify({lastSuccessTime:ja,rollupState:ea}));c('ChatReliabilityInstrumentation').logCHANNEL_STALLED(ia.toString());fa=true;}var ka=Date.now()-ba;if(i.state=='pull'&&ka>q.JUMPSTART_THRESHOLD){ba=null;k.warn('jumpstart',JSON.stringify({state:i.state,dormant:ka}));i.enterState('init');}};c('setIntervalAcrossTransitions')(ha,10000);}function x(){var ba=Date.now(),ca=1;function da(){c('setTimeoutAcrossTransitions')(da,ca*1000);var ia=i.state;if(ia=='idle'&&i.shouldIdle())return;j.bump('conn_t',ca);if(ia=='pull')j.bump('conn_t_pull',ca);}da();var ea=[15,30,60,120,240],fa=false,ga=false;function ha(ia){c('setTimeoutAcrossTransitions')(function(){j.rate('pullenter_'+ia,fa);j.rate('pullexit_'+ia,ga);},ia*1000);}while(ea.length)ha(ea.shift());c('Arbiter').subscribe(c('ChannelConstants').ON_ENTER_STATE,function(ia,ja){if(ja.state=='pull')fa=true;ba=Date.now();});c('Arbiter').subscribe(c('ChannelConstants').ON_EXIT_STATE,function(ia,ja){if(ja.state!='pull'||!ba)return;var ka='other';if(ja.status==c('ChannelConstants').OK){ga=true;ka='ok';}else if(ja.xhr&&ja.xhr.errorType){ka=/ar:(\w+)/.test(ja.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(ja.status))return;var la=(Date.now()-ba)/1000;if(la<0){return;}else if(la>3600)la=3600;j.bump('conn_num');j.bump('conn_exit',la);j.bump('conn_num_'+ka);j.bump('conn_exit_'+ka,la);});}function y(ba){if(ba){t=0;s={};}else t++;}function z(){var ba=!c('AjaxRequest').supportsCORS()||q.forceIframe;if(q.subdomain===null||ba){q.fullHost=q.host;}else q.fullHost=q.subdomain+'-'+q.host;}i={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:o,backoff:false,sessionRegistered:false,init:function(ba,ca){this.init=c('emptyFunction');c('Arbiter').subscribe(c('ChannelConstants').GET_RTI_SESSION_REQUEST,function(event,ga){this.informCurrentSession();}.bind(this));c('requestAnimationFrameAcrossTransitions')(function(){c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'client initialized');c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'using session id: %s at seq: %d with sticky: %s/%s',q.sessionID,q.sequenceId,q.sticky_token,q.sticky_pool);c('UserActivity').subscribe(function(){q.userActive=Date.now();c('ChannelTransport').sendActivePing(q);});});c('PresenceCookieManager').register('ch',v);var da=this.getConfig('max_conn',2);q.subdomain=c('ChannelSubdomain').allocate(da);this._transportRate=new (c('MovingStat'))(30000);var ea=c('AjaxRequest').supportsCORS()&&!q.forceIframe?'CORSTransport':'IframeTransport';this.transport=new (c('ChannelTransport')[ea])(this);m(this.transport);if(ba)this.enterState(ba,ca);c('requestAnimationFrameAcrossTransitions')(function(){c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(event,ga){ga.transportRate=this._transportRate.tally();ga.transportType=ea;ga.transportVersion=2;}.bind(this));w();x();}.bind(this));if(i.getConfig('tryStreaming')&&i.getConfig('host')&&c('AjaxRequest').supportsCORS()&&!q.forceIframe){var fa=q.MIN_INIT_PROBE_DELAY+Math.random()*q.INIT_PROBE_DELAY_RANDOMIZE_RANGE;c('setTimeoutAcrossTransitions')(this._probeTest,fa);}},configure:function(){for(var ba=arguments.length,ca=Array(ba),da=0;da<ba;da++)ca[da]=arguments[da];k.log('configure',JSON.stringify(ca));ca.forEach(function(ea){return Object.assign(q,ea);});z();c('Arbiter').inform(c('ChannelConstants').ON_CONFIG,this);},getConfig:function(ba,ca){return ba in q?q[ba]:ca;},getCompleteConfig:function(){return q;},subscribeIrisQueue:function(ba,ca){q.state.subscribeIrisQueue(ba,ca);this.exitState({status:c('ChannelConstants').OK,stateId:r});},unsubscribeIrisQueue:function(ba){q.state.unsubscribeIrisQueue(ba);},informCurrentSession:function(){var ba=null;if(this.sessionRegistered&&q&&q.fullHost&&q.sticky_token&&q.uid)ba=new (c('RTISession'))(q.fullHost,q.port,q.sticky_pool,q.sticky_token,q.uid,q.viewerUid,q.profile,q.sessionID,q.capabilities);c('Arbiter').inform(c('ChannelConstants').RTI_SESSION,ba);},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(c('SystemEvents').isPageOwner()&&c('SystemEvents').isOnline());},_sendIframeError:function(ba){var ca=new (c('AsyncRequest'))().setURI('/ajax/presence/reconnect.php').setData({reason:ba,fb_dtsg:c('DTSG').getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);ca.specifiesWriteRequiredParams()&&ca.send();},_getDelay:function(){var ba=Math.min(q.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,t-1)),q.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in q)ba=q.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(ba*(1+Math.random()*.5));},resetDelay:function(){y(true);},enterState:function(){if(this._inEnterState){k.warn('enterstate_recursion','{}');c('ChatReliabilityInstrumentation').logERROR('enterstate_recursion');}this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(ba){this._inEnterState=false;throw ba;}},_enterState:function(ba){var ca=this.backoff?this._getDelay():0;this.backoff=false;if(this.isShutdown()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'not executing state due to shutdown mode: %s',ba);return;}if(ba!='idle!'&&this.shouldIdle()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'forced idleness');return;}r++;q.stateId=r;clearTimeout(this._deferredTransition);this._deferredTransition=null;if(!this.transport){n.done(function(ia){return ia.enterState('idle');});c('ChatReliabilityInstrumentation').logERROR('called enterState '+ba+' before transport init');}else this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(ba)){var da=this._transportRate.tally().timeAverage,ea=i.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(da>=ea){if(!this._throttled){this._throttled=true;k.warn('throttled','{}');}j.bump('throttle');ca=1000/ea;}}else if(!(/#$/.test(ba)))ca=this._getDelay();ba=ba.replace(/\W*$/,'');if(!p[ba]){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'invalid state: %s',ba);throw new Error('invalid state:'+ba);}var fa=Array.from(arguments),ga;if(ca<=0){ga={state:ba};this._transportRate.add(1);this.state=ba;var ha=this['_enter_'+this.state];if(ha){fa.shift();ha.apply(this,fa);}if(/init|idle|pull|ping/.test(this.state)){if(q.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];q.is_offline=!c('ChatVisibility').isOnline();q.capabilities=c('FBRTCSupport').getCapabilities();c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'entering transport state: %s',this.state);if(!this.transport){n.done(function(ia){return ia.enterState(this.state,q);}.bind(this));c('ChatReliabilityInstrumentation').logERROR('called enterState '+ba+' before transport init');}else this.transport.enterState(this.state,q);if(this.state=='ping'){ga.url=c('ChannelTransport').getURI(q).toString();ga.port=q.port||'undefined';}}}else{this.state='idle';this.nextState=ba;ga={state:this.state,delay:ca,nextState:ba};fa[0]=ba+'#';this._deferredTransition=c('setTimeoutAcrossTransitions')(function(){this._deferredTransition=null;this.enterState.apply(this,fa);}.bind(this),ca);}if(/pull/.test(ba)){ga.client_id=q.sessionID;ga.streaming=q.inStreaming;}c('Arbiter').inform(c('ChannelConstants').ON_ENTER_STATE,ga);},exitState:function(ba,ca){var da=ba.stateId,ea=ba.status;if(this.isShutdown()||da<r)return;var fa=this.state,ga=Array.from(arguments);ga[0]=ba.status;var ha={state:fa,status:ea};if(/pull/.test(fa)){ha.client_id=q.sessionID;ha.streaming=q.inStreaming;}if(/ping/.test(fa)&&ea!=c('ChannelConstants').OK)ha.url=c('ChannelTransport').getURI(q).toString();if(this.nextState)ha.nextState=this.nextState;if(ca&&ca.errorType){q.lastRequestErrorReason=ca.errorType;ha.xhr=ca.toJSON?ca.toJSON():ca;if(ca.errorType==c('AjaxRequest').SERVICE_UNAVAILABLE){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'got 5xx http status code, setting long delay');this.proxyDown=true;}delete ha.xhr.json;}else if(ea!=c('ChannelConstants').OK)q.lastRequestErrorReason=ea;if(ca&&ca.json){if(ca.json.t)ha.t=ca.json.t;if(ca.json.reason)ha.reason=ca.json.reason;if(ca.json.seq)ha.seq=ca.json.seq;}c('Arbiter').inform(c('ChannelConstants').ON_EXIT_STATE,ha);var ia=this['_exit_'+fa];if(ia)ea=ia.apply(this,ga)||ea;if(ea!=c('ChannelConstants').OK){y();s[fa]=(s[fa]||0)+1;}var ja=p[this.nextState||fa][ea]||p._all[ea],ka=ja&&ja.replace(/!*$/,'');if(!ka){k.error('terminal_transition',JSON.stringify(ha));this._shutdownHint=c('ChannelConstants').HINT_INVALID_STATE;ja='shutdown!';c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'entering shutdown state');}this._lastState=fa;this._lastStatus=ea;this.enterState(ja);},_processTransportData:function(ba,ca){this._processTransportData0(ba,ca,ca.json);},_processTransportData0:function(ba,ca,da){var ea=da.t;if('s' in da){da.seq=da.s;delete da.s;}if(da.u&&q.user&&da.u!=q.user){k.warn('misguided_msg',JSON.stringify({user:q.user,target:da.u}));this._reportProxyMisguidedMsg(da.u,q.user);return;}var fa=q.seq;if('seq' in da){q.seq=da.seq;c('PresenceState').doSync();}switch(ea){case 'continue':if(q.inStreaming&&this.heartbeats.length<1){q.streamingCapable=false;k.log('switch_to_longpoll','{}');c('setTimeoutAcrossTransitions')(this._probeTest,q.PROBE_DELAY);}y(true);if(!q.inStreaming||q.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:c('ChannelConstants').OK,stateId:ba});break;case 'refresh':case 'refreshDelay':c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'got refresh with reason: %s',da.reason);this.exitState({status:'refresh_'+(da.reason||0),stateId:ba},ca);break;case 'backoff':c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'server told client to back off');y();this.backoff=true;break;case 'lb':var ga=da.lb_info;if(ga){q.sticky_token=ga.sticky;if('pool' in ga)q.sticky_pool=ga.pool;if('sd' in ga)q.subdomain=ga.subdomain;if('vip' in ga)q.host=ga.vip;z();}else k.error('missing_lb_info','{}');break;case 'test_streaming':c('setTimeoutAcrossTransitions')(this._probeTest,500);break;case 'fullReload':c('PresenceCookieManager').clear();k.log('full_reload','{}');this.sessionRegistered=true;this.informCurrentSession();c('Arbiter').inform(c('ChannelConstants').ON_INVALID_HISTORY);y(true);c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'full reload incurred');var ha=c('ChannelConstants').OK;this.exitState({status:ha,stateId:ba},ca);if('ms' in da)this._processMessages(da,fa);break;case 'msg':y(true);this._processMessages(da,fa);break;case 'heartbeat':if(q.inStreaming){var ia=Date.now();if(this.heartbeats.length>0)var ja=ia-this.heartbeats[this.heartbeats.length-1];k.log('heartbeat_interval',JSON.stringify({client_id:q.sessionID,interval:ja}));this.heartbeats.push(ia);}break;case 'batched':var ka=da.batches,la;for(la=0;la<ka.length;la++)this._processTransportData0(ba,ca,ka[la]);break;default:c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'got an unknown protocol message: %s',ea);k.error('unknown_msg_type',JSON.stringify({type:ea}));break;}},_processMessages:function(ba,ca){var da,ea,fa,ga;if('tr' in ba)q.trace_id=ba.tr;ea=ba.ms;fa=q.seq-ea.length;for(da=0;da<ea.length;da++,fa++){q.estimatedReceived++;if(fa>=ca){ga=ea[da];if(ga.type){var ha=c('ChannelConstants').getArbiterType(ga.type);if(ga.type==='messaging'){var ia={type:'messaging',event:ga.event};if(ga.message){ia.inbox_unread=ga.unread_counts&&ga.unread_counts.inbox;ia.tid=ga.message.tid;ia.mid=ga.message.mid;c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'got message with id: %s',ga.message.mid);}}else if(ga.type==='pages_messaging'){if(ga.unread_counts&&ga.unread_counts.inbox)c('Arbiter').inform(c('ChannelConstants').getArbiterType('pages_inbox_count_update'),{page_id:ga[c('MessagingRealtimeConstants').VIEWER_FBID],inbox_unread:ga.unread_counts.inbox});}else if(ga.type==='skywalker'){ha=c('ChannelConstants').SKYWALKER;}else if(ga.type==='qprimer'){ga.first=!q.ready;if(ga.first){q.ready=true;q.timeUntilReady=Date.now()-q.created;q.queueMade=ga.made;}ha=c('ChannelConstants').CHANNEL_ESTABLISHED;}else if(ga.type==='pws'){q.pws=ga.pws;}else if(ga.type==='delta')q.sequenceId=ga.iseq;c('Arbiter').inform(ha,{obj:ga});}}else k.warn('seq_regression',JSON.stringify({last_seq:ca,messages:ea.length,seq:fa}));}},_enter_init:function(){if(s.init>=i.getConfig('MAX_INIT_FAILS',2))return setTimeout(this.exitState.bind(this,{status:c('ChannelConstants').ERROR_MAX,stateId:r}),0);this._initTimer=c('setTimeoutAcrossTransitions')(this.exitState.bind(this,{status:c('ChannelConstants').ERROR,stateId:r},'timeout'),q.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function(ba){k.warn('enter_reconnect',ba);c('FantailLogger').info(c('ChannelConstants').FANTAIL_SERVICE,'entered reconnect with reason: %s',ba);var ca=r;if(!c('PresenceUtil').hasUserCookie()){c('FantailLogger').warn(c('ChannelConstants').FANTAIL_SERVICE,'user has no cookie???');k.warn('no_user_cookie','{}');setTimeout(function(){i._shutdownHint=c('ChannelConstants').HINT_AUTH;i.exitState({status:c('ChannelConstants').ERROR_SHUTDOWN,stateId:ca});},0);return;}var da={reason:ba,fb_dtsg:c('DTSG').getToken()};if(c('ISB').token)da.fb_isb=c('ISB').token;if(l)l(da);var ea=new (c('FBAjaxRequest'))('GET','/ajax/presence/reconnect.php',da);ea.onSuccess=function(){i.configure(ea.json);c('PresenceCookieManager').store();this.exitState({status:c('ChannelConstants').OK,stateId:ca});}.bind(this);ea.onError=function(){var fa=ea.json&&ea.json.error;c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'reconnect error: %s',ea.errorType);if(ea.errorType==c('AjaxRequest').TRANSPORT_ERROR||ea.errorType==c('AjaxRequest').PROXY_ERROR||ea.errorType==c('AjaxRequest').SERVICE_UNAVAILABLE)this._shutdownHint=c('ChannelConstants').HINT_CONN;if(fa&&fa==1356007){this._shutdownHint=c('ChannelConstants').HINT_MAINT;}else if(fa==1357001||fa==1357004||fa==1348009){this._shutdownHint=c('ChannelConstants').HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?c('ChannelConstants').ERROR_SHUTDOWN:c('ChannelConstants').ERROR,stateId:ca},ea);}.bind(this);ea.send();},_enter_shutdown:function(){c('Arbiter').inform(c('ChannelConstants').ON_SHUTDOWN,{reason:this._shutdownHint});if('shutdown_recovery_interval_seconds' in q&&q.shutdown_recovery_interval_seconds>0){var ba=q.shutdown_recovery_interval_seconds*1000;c('setTimeoutAcrossTransitions')(function(){c('Arbiter').inform(c('ChannelConstants').ATTEMPT_RECONNECT);this.state='reconnect!';this.enterState('reconnect!');}.bind(this),ba);}},_exit_init:function(ba){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(ba==c('ChannelConstants').ERROR_MAX)this._sendIframeError(c('ChannelConstants').reason_IFrameLoadGiveUp);},_exit_pull:function(ba,ca){var da=ba==c('ChannelConstants').OK;if(da){this.lastPullTime=Date.now();}else{var ea='exit status: '+ba;if(ca&&ca.errorType)ea+=' ajax request error: '+ca.errorType;c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'pull failed with status: %s',ea);}},_exit_ping:function(ba){if(ba==c('ChannelConstants').OK){var ca=Date.now()-(this.lastPullTime||c('Env').start);if(ca>q.STALL_THRESHOLD){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'didnt complete a successful pull for too long');return c('ChannelConstants').ERROR_STALE;}}else c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'ping failed with status: %s',ba);},_reportProxyMisguidedMsg:function(ba,ca){c('FantailLogger').error(c('ChannelConstants').FANTAIL_SERVICE,'misguided message to %d meant for %d',ca,ba);var da=Date.now();if(da-this.lastReportOnMisguidedMsgTime<=q.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=da;var ea={received_uid:ba,expected_uid:ca};if(q.sticky_token)ea.sticky_token=q.sticky_token;var fa=new (c('URI'))('/err_misguided_msg').setDomain(q.host+'.'+q.domain).setPort(q.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(ea),ga=new (c('AjaxRequest'))('GET',fa);if(c('AjaxRequest').supportsCORS())ga.xhr.withCredentials=true;ga.onSuccess=function(ha){};ga.onError=function(ha){};ga.onJSON=function(ha,ia){};ga.send();},_probeTest:function(){q.streamingCapable=false;var ba=[],ca={mode:'stream',format:'json'};if(q.sticky_token)ca.sticky_token=q.sticky_token;var da=new (c('URI'))('/probe').setDomain(q.host+'.'+q.domain).setPort(q.port).setSecure(new (c('URI'))(window.location.href).isSecure()).setQueryData(ca),ea=new (c('AjaxRequest'))('GET',da);ea.onJSON=function(fa,ga){if(fa&&fa.json&&fa.json.t==='heartbeat'){ba.push(Date.now());if(ba.length>=2){var ha=ba[1]-ba[0];if(ha>=q.PROBE_HEARTBEATS_INTERVAL_LOW&&ha<=q.PROBE_HEARTBEATS_INTERVAL_HIGH){q.streamingCapable=true;k.log('switch_to_streaming','{}');}}}};ea.onSuccess=function(fa){if(ba.length!=2){q.streamingCapable=false;k.error('probe_error',JSON.stringify({error:'beats.length = '+ba.length}));}k.log('probe_success','{}');};ea.onError=function(fa){q.streamingCapable=false;k.error('probe_error',JSON.stringify(fa));};ea.send();}};f.exports=i;function aa(){if(c('ChannelInitialData').channelConfig){i.configure(c('ChannelInitialData').channelConfig);if(/shutdown/.test(c('ChannelInitialData').state))i._shutdownHint=c('ChannelConstants')[c('ChannelInitialData').reason];i.init(c('ChannelInitialData').state,c('ChannelInitialData').reason);c('ChatReliabilityInstrumentation').logCHANNEL_INIT();}else c('ChatReliabilityInstrumentation').logCHANNEL_NOCONFIG();}aa();},6);
__d('ChannelConnection',['Arbiter','ChannelConstants','ChannelManager','JSLogger','Run','SystemEvents','Visibility','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('JSLogger').create('channel_connection'),i=null,j=null,k=null,l=null,m=0,n=Object.assign(new (c('Arbiter'))(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});c('Run').onBeforeUnload(function(){});function o(){if(j){clearTimeout(j);j=null;}}function p(){o();h.log('unmute_warning');n.inform(n.UNMUTE_WARNING);}function q(v){o();j=c('setTimeoutAcrossTransitions')(p,v);h.log('mute_warning',{time:v});n.inform(n.MUTE_WARNING);}function r(){if(k){clearTimeout(k);k=null;}}function s(v,w){r();if(v===c('ChannelConstants').ON_ENTER_STATE&&(w.nextState||w.state)==='pull'){if(l!==n.CONNECTED){h.log('connected');var x=!l;l=n.CONNECTED;m=0;n.inform(n.CONNECTED,{init:x});}}else if(v===c('ChannelConstants').ON_ENTER_STATE&&((w.nextState||w.state)==='ping'||!w.nextState&&w.state==='idle')){k=c('setTimeoutAcrossTransitions')(function(){var y=null;if(!(w.state==='idle'&&!w.nextState))y=w.delay||0;h.log('reconnecting',{delay:y});if(n.disconnected())h.log('reconnecting_ui',{delay:y});l=n.RECONNECTING;w.state==='idle'&&m++;if(m>1){n.inform(n.RECONNECTING,y);}else if(!w.nextState&&w.state==='idle')s(v,w);},500);}else if(v===c('ChannelConstants').ON_SHUTDOWN){h.log('shutdown',{reason:w.reason});l=n.SHUTDOWN;m=0;n.inform(n.SHUTDOWN,w.reason);}}function t(){if(c('ChannelManager').isShutdown()){s(c('ChannelConstants').ON_SHUTDOWN,c('ChannelManager')._shutdownHint);}else s(c('ChannelConstants').ON_ENTER_STATE,{state:c('ChannelManager').state,nextState:c('ChannelManager').nextState,delay:0});c('Visibility').addListener(c('Visibility').VISIBLE,n.reconnect);}c('Run').onAfterLoad(t);Object.assign(n,{disconnected:function(){return l===n.SHUTDOWN||l===n.RECONNECTING&&!j&&m>1;},isShutdown:function(){return l===n.SHUTDOWN;},reconnect:function(v){if(c('ChannelManager').state==='ping'||c('ChannelManager').state==='pull'||c('ChannelManager').isShutdown())return;h.log('reconnect',{now:v});n.inform(n.RECONNECTING,0);if(!!v){if(i!==null){clearTimeout(i);i=null;}c('ChannelManager').enterState('ping!');}else if(!i)i=c('setTimeoutAcrossTransitions')(function(){c('ChannelManager').enterState('ping!');i=null;},c('ChannelConstants').CHANNEL_MANUAL_RECONNECT_DEFER_MSEC);c('ChannelManager').resetDelay();},unmuteWarning:p});function u(){c('Arbiter').subscribe([c('ChannelConstants').ON_ENTER_STATE,c('ChannelConstants').ON_SHUTDOWN],s);c('Arbiter').subscribe(c('ChannelConstants').ATTEMPT_RECONNECT,function(){if(n.disconnected())n.reconnect();});c('SystemEvents').subscribe(c('SystemEvents').TIME_TRAVEL,function(){n.reconnect();q(c('ChannelConstants').MUTE_WARNING_TIME_MSEC);});c('Run').onBeforeUnload(r,false);}c('Run').onAfterLoad(u);n.mockAfterLoad=function(){t();u();};c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(v,w){w.channel_connected=!n.disconnected();});f.exports=n;},6);
__d('BuddyListNub',['csx','cx','fbt','Arbiter','AsyncRequest','AvailableList','BootloadedComponent.react','ChannelConnection','ChatOptions','ChatSidebarActions','ChatSidebarStore','ChatSidebarVisibility','ChatVisibility','CSS','Dock','DOM','Event','JSLogger','JSResource','KeyEventController','Keys','NubController','OrderedFriendsList','Parent','PresencePrivacy','PresenceStatus','PresenceUtil','React','ReactDOM','Run','SidebarType','Style','Toggler','emptyFunction'],function a(b,c,d,e,f,g,h,i,j){var k,l;if(c.__markCompiled)c.__markCompiled();var m=40,n=253,o='285px',p=c('JSLogger').create('buddylist_nub');k=babelHelpers.inherits(q,c('NubController'));l=k&&k.prototype;function q(r,s,t,u){'use strict';l.constructor.call(this);l.init.call(this,r);this.root=r;this.orderedList=s;this.button=c('DOM').find(r,'a.fbNubButton');this.unreadCount=c('DOM').find(r,"span._5ayx");this.label=c('DOM').find(r,'span.label');this.body=c('DOM').scry(r,'div.fbNubFlyoutBody')[0];this.container=c('Parent').bySelector(r,"._56ox");var v=c('DOM').find(r,'div.fbNubFlyoutTitlebar');c('Toggler').createInstance(v).setSticky(false);c('Toggler').createInstance(r).setSticky(true);if(u)c('Run').onAfterLoad(function(){this.dropdown=c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('span',null),bootloadLoader:c('JSResource')('ChatSidebarDropdown.react'),onToggleSidebar:function(){},sidebarType:c('SidebarType').BUDDYLIST}),u);}.bind(this));s.subscribeOnce('render',this.flyoutContentChanged.bind(this));c('Run').onAfterLoad(function(){var w=c('DOM').find(v,"div._4k48");if(w)c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('span',null),bootloadLoader:c('JSResource')('ChatSidebarComposeLink.react'),className:"_3a-4"}),w);var x=c('DOM').find(this.button,"div._1us9");if(x)c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('span',null),bootloadLoader:c('JSResource')('ChatSidebarComposeLink.react'),className:"_3a-4"}),x);var y=c('DOM').find(this.button,"div._1usa");if(y)c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('span',null),bootloadLoader:c('JSResource')('ChatSidebarDropdown.react'),onToggleSidebar:function(){},sidebarType:c('SidebarType').BUDDYLIST_NUB}),y);}.bind(this));s.setScrollContainer(this.body);c('AvailableList').subscribe('buddylist/availability-changed',this._updateCount.bind(this));c('Arbiter').subscribe('chat/connect',function(){return this._handleConnect(true);}.bind(this));c('Arbiter').subscribe('chat/option-changed',function(w,x){if(x.name=='hide_groups'){this.onResize();}else if(x.name==='hide_buddylist')x.value?this.hide():this.show();}.bind(this));c('ChannelConnection').subscribe(c('ChannelConnection').CONNECTED,function(){return this._updateView();}.bind(this));c('ChannelConnection').subscribe(c('ChannelConnection').SHUTDOWN,function(){return this._updateView();}.bind(this));c('ChannelConnection').subscribe(c('ChannelConnection').RECONNECTING,function(){return this._updateView();}.bind(this));c('ChannelConnection').subscribe([c('ChannelConnection').MUTE_WARNING,c('ChannelConnection').UNMUTE_WARNING],function(){return this._updateView();}.bind(this));this.subscribe('show',this.onShow.bind(this));this.subscribe('hide',this.onHide.bind(this));this.subscribe('resize',this.onResize.bind(this));c('Event').listen(r,'keydown',this._onKeyDown.bind(this));c('Event').listen(this.button,'click',this.onButtonClick.bind(this));c('KeyEventController').registerKey('q',function(event){if(!(this._isOpen)){this.onButtonClick();this.show();}event.prevent();}.bind(this));c('Arbiter').subscribe('minisidebar/show',this.hide.bind(this));c('Arbiter').subscribe('sidebar/visibility',function(w,x){if(x){this.hide();}else this._onSidebarHide();}.bind(this));this._orderedListCount=c('OrderedFriendsList').getList().length;c('Style').set(this.body,'min-height',o);c('Arbiter').subscribe('sidebar/typeahead/active',function(w,x){if(x){this._typeaheadActive=true;c('CSS').hide(this.body.parentNode);this.orderedList.hide();this.onResize();}else{this._typeaheadActive=false;this.onResize();c('CSS').show(this.body.parentNode);this.orderedList.show();}}.bind(this));if(c('ChatSidebarStore').isEnabled()&&c('ChatSidebarStore').getVisibleType()===c('SidebarType').BUDDYLIST&&!c('ChatOptions').getSetting('hide_buddylist')&&!c('ChannelConnection').disconnected()&&!c('PresencePrivacy').isUserOffline()&&this._orderedListCount>0)this.show();c('Event').listen(v,'click',function(w){if(c('CSS').matchesSelector(w.target,".titlebarTextWrapper"))this._syncHideBuddylist(true);}.bind(this));this._updateView();p.log('buddylist_initialized');}q.prototype._handleVisibilityChange=function(){'use strict';this._updateView();if(!c('ChatVisibility').isOnline())this.hide();};q.prototype._updateView=function(r){'use strict';var s,t;if(!c('ChatVisibility').isOnline()){s=j._("{Chat} (Off)",[j.param('Chat',j._("Discussion instantan\u00e9e"))]);}else if(c('ChannelConnection').disconnected()){s=j._("{Chat} (d\u00e9connect\u00e9e)",[j.param('Chat',j._("Discussion instantan\u00e9e"))]);}else{var u=c('PresenceStatus').getOnlineCount();if(u){var v=c('DOM').create('span',{className:'count'},'('+u+')');s=j._({"*":"{Chat} {number-available}"},[j.param('Chat',j._("Discussion instantan\u00e9e")),j.param('number-available',v,[0,u])]);}else{s=j._("Discussion instantan\u00e9e");t=true;}}this._setPresenceIcon();this._setUnread();this._setLabel(s,t);this.buttonContentChanged();};q.prototype._setPresenceIcon=function(){'use strict';c('CSS').conditionClass(this.root,'offline',!c('ChatVisibility').isOnline()||c('ChannelConnection').disconnected());};q.prototype.onButtonClick=function(){'use strict';if(!c('ChatSidebarStore').isInitialized())return true;var r=c('ChatSidebarStore').isEnabled(),s=c('ChatSidebarVisibility').shouldShowSidebarIgnoreEnabled();if(!r&&s){c('ChatSidebarActions').enable();}else c('ChatSidebarActions').show();return !s;};q.prototype.onHide=function(){'use strict';this._isOpen=false;if(this._buddyListRenderSubscription){this.orderedList.unsubscribe(this._buddyListRenderSubscription);this._buddyListRenderSubscription=null;}this._hideBuddyList();c('Arbiter').inform('buddylist/hide');};q.prototype._onKeyDown=function(event){'use strict';var r=c('Event').getKeyCode(event);if(r===c('Keys').ESC&&!c('CSS').hasClass(this.root,'menuOpened')){this.hide();return false;}else if(r==c('Keys').RETURN)c('ChatSidebarActions').enable();};q.prototype._onSidebarHide=function(event){'use strict';if(c('ChatSidebarStore').isEnabled()&&!c('ChatOptions').getSetting('hide_buddylist')&&!c('ChannelConnection').disconnected()&&!c('PresencePrivacy').isUserOffline()){this.show();}else{this.hide();this.button.focus();}};q.prototype.onResize=function(){'use strict';var r=!this._typeaheadActive?n:c('Dock').getMaxFlyoutHeight(this.root)-60;c('Arbiter').inform('buddyList/resized',r,c('Arbiter').BEHAVIOR_PERSISTENT);if(this._typeaheadActive){c('Style').set(this.body,'max-height','none');}else c('Style').set(this.body,'max-height',o);var s=Math.max(250,r),t=Math.floor(s/m);this.orderedList.setNumTopFriends(t);};q.prototype._showBuddyList=function(){'use strict';this._buddyListRenderSubscription=this.orderedList.subscribe('render',function(){if(c('Style').get(this.body,'height')!=o)c('Style').set(this.body,'height',o);}.bind(this));this.orderedList.show();p.bump('buddylist_show');};q.prototype._hideBuddyList=function(){'use strict';this.orderedList.hide();p.bump('buddylist_hide');};q.prototype.onShow=function(){'use strict';this._isOpen=true;if(c('ChannelConnection').disconnected()){c('ChannelConnection').reconnect();this._showBuddyList();}else c('ChatVisibility').goOnline(this._showBuddyList.bind(this));this._syncHideBuddylist(false);};q.prototype._setLabel=function(r,s){'use strict';var t=this.label.textContent||this.label.innerText;if(t!==r){var u=this.label.cloneNode(true);c('DOM').setContent(u,r);c('DOM').replace(this.label,u);this.label=u;}this.throbber&&c('CSS').conditionShow(this.throbber,!!s);};q.prototype._setUnread=function(r){'use strict';c('CSS').conditionShow(this.unreadCount,!!r);};q.prototype._updateCount=function(){'use strict';this._updateView();};q.prototype._syncHideBuddylist=function(r){'use strict';c('ChatOptions').setSetting('hide_buddylist',r,'buddylist');new (c('AsyncRequest'))('/ajax/chat/settings.php').setHandler(c('emptyFunction')).setErrorHandler(c('emptyFunction')).setData({hide_buddylist:r,window_id:c('PresenceUtil').getSessionID()}).setAllowCrossPageTransition(true).send();};c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(r,s){s.buddylist_visible=c('ChatSidebarStore').getVisibleType()===c('SidebarType').BUDDYLIST;});f.exports=q;},null);
__d('ChatSearchSource',['requireWeak','AbstractSearchSource','AsyncRequest','CurrentUser','MercuryConfig','MercuryParticipantTypes','SearchableEntry','SearchSourceCallbackManager','ShortProfiles','TokenizeUtil','debounce','emptyFunction','isValidUniqueID'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=null;c('requireWeak')('OrderedFriendsList',function(l){j=l;});h=babelHelpers.inherits(k,c('AbstractSearchSource'));i=h&&h.prototype;function k(l){i.constructor.call(this);this.$ChatSearchSource1=new (c('SearchSourceCallbackManager'))({parseFn:c('TokenizeUtil').parse,matchFn:c('TokenizeUtil').isQueryMatch,indexFn:l.indexFn});this.$ChatSearchSource2=l.queryRequests||[];this.$ChatSearchSource3=false;this.$ChatSearchSource4=c('debounce')(this.$ChatSearchSource4,100,this);}k.prototype.bootstrapImpl=function(l){c('ShortProfiles').fetchAll().done(function(){this.$ChatSearchSource3=true;this.$ChatSearchSource5();l();}.bind(this));};k.prototype.searchImpl=function(l,m,n){var o=null,p={},q=n&&n.onQueryFinished,r=n&&n.onQueryStarted;r&&r(l);var s=this.$ChatSearchSource1.search(l,function(v){if(!o){o=v;o.forEach(function(w){return p[w.getUniqueID()]=true;});}else v.forEach(function(w){var x=w.getUniqueID();if(!p[x]){o.push(w);p[x]=true;}});m(o,l);if(l.length===1&&this.$ChatSearchSource3)q&&q(l);}.bind(this),n);if(!s||!this.$ChatSearchSource2||!this.$ChatSearchSource2.length||l.length===0){q&&q(l);return;}if(l.length===1){if(this.$ChatSearchSource3)q&&q(l);return;}var t={value:l,existing_ids:o&&o.map(function(v){return v.getUniqueID();}).join(','),limit:n&&n.threadLimit},u=this.$ChatSearchSource2.length;this.$ChatSearchSource2.forEach(function(v){this.$ChatSearchSource4(t,v,function(w){this.$ChatSearchSource6(this.$ChatSearchSource7(this.$ChatSearchSource8(w)).filter(function(x){return !!x;}),l);u--;if(u===0){this.$ChatSearchSource1.setQueryStringAsExhausted(l);q&&q(l);}}.bind(this));}.bind(this),this);};k.prototype.getAllEntriesMap=function(){return this.$ChatSearchSource1.getAllEntries();};k.prototype.$ChatSearchSource5=function(){var l=c('ShortProfiles').getCachedProfileIDs(),m=l.filter(function(o){var p=c('ShortProfiles').getNow(o);return (o==c('CurrentUser').getID()||p.type===c('MercuryParticipantTypes').FRIEND||p.type===c('MercuryParticipantTypes').PAGE&&c('MercuryConfig').LinkedAgents&&c('MercuryConfig').LinkedAgents.indexOf(o.toString())>-1);}),n=m.map(this.$ChatSearchSource9);if(n.length)this.$ChatSearchSource1.addLocalEntries(n);};k.prototype.$ChatSearchSource7=function(l){return l.map(this.$ChatSearchSource10,this);};k.prototype.$ChatSearchSource10=function(l,m){if(l.mercury_thread){if(!j)return null;return j.normalizeThreadEntry(l,m);}var n=l.text,o=l.uid;if(!n||!c('isValidUniqueID')(o))return null;var p=j?j.getActiveRank(o):0;if(j&&!j.contains(o))p+=m;return new (c('SearchableEntry'))({uniqueID:o,title:n,order:p,subtitle:l.subtext,type:l.render_type||l.type,photo:l.photo,uri:l.path,auxiliaryData:{isMessengerUser:l.is_messenger_user,alias:l.alias}});};k.prototype.$ChatSearchSource8=function(l){var m=l.getPayload();if(Array.isArray(m)){return m;}else if(m&&m.entries){return m.entries;}else return [];};k.prototype.$ChatSearchSource9=function(l){var m=c('ShortProfiles').getNow(l),n=l==c('CurrentUser').getID()?c('MercuryParticipantTypes').FRIEND:m.type,o=[m.additionalName,m.alternateName].concat(m.searchTokens||[]).join(' '),p=m.name,q=m.additionalName;if(m.threadNickname){p=m.threadNickname;q=m.name;}return new (c('SearchableEntry'))({uniqueID:l,title:p,order:j?j.getActiveRank(l):0,subtitle:q,keywordString:o,type:n,photo:m.thumbSrc,uri:m.uri,auxiliaryData:{isMessengerUser:m.is_messenger_user,alias:m.alias}});};k.prototype.$ChatSearchSource4=function(l,m,n,o){new (c('AsyncRequest'))(m.uri).setData(babelHelpers['extends']({},l,m.data)).setMethod('GET').setReadOnly(true).setHandler(n).setErrorHandler(o||c('emptyFunction')).setAllowCrossPageTransition(true).send();};k.prototype.$ChatSearchSource6=function(l,m){if(l.length)this.$ChatSearchSource1.addQueryEntries(l,m);};k.prototype.addLocalEntries=function(l){this.$ChatSearchSource1.addLocalEntries(l);};k.prototype.refreshData=function(){c('ShortProfiles').fetchAll();};f.exports=k;},null);
__d('ChatSidebarComposeLink.react',['fbt','ChatOpenTab','Link.react','React','TooltipData'],function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;function k(l){j.constructor.call(this,l);}k.prototype.render=function(){var l=h._("Nouveau message");return (c('React').createElement(c('Link.react'),babelHelpers['extends']({className:this.props.className,href:'#',onClick:this.$ChatSidebarComposeLink1},c('TooltipData').propsFor(l))));};k.prototype.$ChatSidebarComposeLink1=function(l){c('ChatOpenTab').openEmptyTab(null,'sidebar');l.preventDefault();};f.exports=k;},null);
__d('ChatSidebarSheetChatOffline.react',['fbt','Link.react','React','ReactComponentWithPureRenderMixin'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'ChatSidebarSheetChatOffline',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{onGoOnlineClick:i.func.isRequired},render:function(){return (c('React').createElement('div',null,h._("{=Go online} pour voir qui est disponible.",[h.param('=Go online',c('React').createElement(c('Link.react'),{className:'fbChatGoOnlineLink',onClick:this.props.onGoOnlineClick},h._("Activer la discussion instantan\u00e9e")))])));}});f.exports=j;},null);
__d('MessengerSpinner.react',['cx','fbt','ix','Image.react','ReactComponentWithPureRenderMixin','React','joinClasses'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=j('/images/mercury/clients/messenger/core/LoadingSpinner.png'),m=j('/images/mercury/clients/messenger/core/LoadingSpinnerGrey.png'),n=j('/images/mercury/clients/messenger/core/LoadingSpinnerExtraLarge.png'),o=24,p=32,q=c('React').createClass({displayName:'MessengerSpinner',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{color:k.oneOf(['blue','grey']),size:k.oneOf([o,p])},getDefaultProps:function(){return {color:'blue',size:o};},render:function(){return (c('React').createElement(c('Image.react'),{'aria-label':i._("Chargement..."),'aria-busy':true,className:c('joinClasses')(this.props.className,"_3u55 _3qh2"),height:this.props.size,src:this._getSpinnerSrc(),width:this.props.size}));},_getSpinnerSrc:function(){return this.props.size===o?this.props.color==='blue'?l:m:n;}});q.Sizes={LARGE:p,MEDIUM:o};f.exports=q;},null);
__d('ChatSidebarSheetChatReconnectMsg.react',['fbt','ChannelConstants','Link.react','MessengerSpinner.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'ChatSidebarSheetChatReconnectMsg',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{isMessenger:i.bool,msecs:i.number,onManuallyConnectClick:i.func},render:function(){var k=this.props,l=k.isMessenger,m=k.msecs,n=c('React').createElement(c('Link.react'),{className:'fbChatReconnectLink',onClick:this.props.onManuallyConnectClick},h._("Pas de connexion internet"));if(m==null||false===navigator.onLine){return (l?n:c('React').createElement('div',null,h._("Impossible de se connecter \u00e0 la discussion instantan\u00e9e. V\u00e9rifiez votre connexion Internet.")));}else if(m>c('ChannelConstants').WARNING_COUNTDOWN_THRESHOLD_MSEC){return (l?n:c('React').createElement('div',null,h._("Impossible de se connecter \u00e0 la discussion instantan\u00e9e. {try-again-link}",[h.param('try-again-link',c('React').createElement(c('Link.react'),{className:'fbChatReconnectLink',onClick:this.props.onManuallyConnectClick},h._("Veuillez r\u00e9essayer")))])));}else if(m>1000){return (l?n:c('React').createElement('div',null,h._("Impossible de se connecter \u00e0 la discussion instantan\u00e9e. Reconnexion dans {seconds} secondes...",[h.param('seconds',Math.floor(m/1000))])));}else return (l?c('React').createElement('div',null,c('React').createElement(c('MessengerSpinner.react'),{color:'grey'}),h._("Connexion...")):c('React').createElement('div',null,h._("Impossible de se connecter \u00e0 la discussion instantan\u00e9e. Reconnexion...")));}});f.exports=j;},null);
__d('ChatSidebarSheetChatShutdownMsg.react',['fbt','ChannelConstants','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'ChatSidebarSheetChatShutdownMsg',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{hint:i.string,isMessenger:i.bool},render:function(){var k=this.props,l=k.hint,m=k.isMessenger;switch(l){case c('ChannelConstants').HINT_AUTH:return (c('React').createElement('div',null,h._("Votre session a expir\u00e9. Veuillez vous reconnecter.")));case c('ChannelConstants').HINT_MAINT:return (m?c('React').createElement('div',null,h._("Messenger est en cours de maintenance.")):c('React').createElement('div',null,h._("{Chat} est en cours de maintenance.",[h.param('Chat',h._("Discussion instantan\u00e9e"))])));case c('ChannelConstants').HINT_CONN:default:return (m?c('React').createElement('div',null,h._("Messenger est actuellement indisponible.")):c('React').createElement('div',null,h._("{Chat} Facebook n\u2019est pas disponible.",[h.param('Chat',h._("Discussion instantan\u00e9e"))])));}}});f.exports=j;},null);
__d('ChatSidebarSheet.react',['fbt','ChannelConnection','ChatBehavior','ChatSidebarSheetChatOffline.react','ChatSidebarSheetChatReconnectMsg.react','ChatSidebarSheetChatShutdownMsg.react','ChatVisibility','CurrentEnvironment','CSS','JSLogger','PresencePrivacy','ReactComponentWithPureRenderMixin','React','SubscriptionsHandler','emptyFunction','joinClasses','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('JSLogger').create('sidebar_sheet'),j=c('React').PropTypes,k=c('React').createClass({displayName:'ChatSidebarSheet',mixins:[c('ReactComponentWithPureRenderMixin')],getInitialState:function(){return {channelStatus:null,channelData:null,isConnected:!c('ChannelConnection').disconnected(),isOnline:c('ChatVisibility').isOnline(),notifiesUserMessages:c('ChatBehavior').notifiesUserMessages()};},getDefaultProps:function(){return {onUpdate:c('emptyFunction')};},_subscriptions:c('SubscriptionsHandler'),_showWarningTimeout:null,componentDidMount:function(){this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(c('ChannelConnection').subscribe([c('ChannelConnection').CONNECTED,c('ChannelConnection').SHUTDOWN,c('ChannelConnection').RECONNECTING],this._handleConnectionChange),c('ChannelConnection').subscribe([c('ChannelConnection').MUTE_WARNING,c('ChannelConnection').UNMUTE_WARNING],this._calculateState),c('PresencePrivacy').subscribe('privacy-user-presence-changed',this._calculateState),c('ChatBehavior').subscribe(c('ChatBehavior').ON_CHANGED,this._calculateState));},componentWillUpdate:function(){if(this._showWarningTimeout){clearTimeout(this._showWarningTimeout);this._showWarningTimeout=null;}},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();},render:function(){var l=c('CurrentEnvironment').messengerdotcom,m=void 0,n=void 0;if(!this.state.isOnline&&!l){m='offline';n=this._renderOffline();}else if(!this.state.isConnected){m='error';n=this._renderChannelDisconnect(l);}else if(!this.state.notifiesUserMessages&&!l){m='notice';n=this._renderNotice();}if(this.state.channelStatus===c('ChannelConnection').RECONNECTING&&this.state.channelData<1000)m=c('joinClasses')(m,'reconnecting');return (c('React').createElement('div',{className:c('joinClasses')(this.props.className,m)},l?null:c('React').createElement('div',{className:'img'}),c('React').createElement('div',{className:'message'},n)));},_handleConnectionChange:function(l,m){this.setState({channelStatus:l,channelData:m});this._calculateState();},_calculateState:function(){this.setState({isConnected:!c('ChannelConnection').disconnected(),isOnline:c('ChatVisibility').isOnline(),notifiesUserMessages:c('ChatBehavior').notifiesUserMessages()});},_renderChannelDisconnect:function(l){if(this.state.channelStatus===c('ChannelConnection').SHUTDOWN){return (c('React').createElement(c('ChatSidebarSheetChatShutdownMsg.react'),{hint:this.state.channelData,isMessenger:l}));}else if(this.state.channelStatus===c('ChannelConnection').RECONNECTING){var m=this.state.channelData;if(m>1000)this._showWarningTimeout=c('setTimeoutAcrossTransitions')(this._handleConnectionChange.bind(this,c('ChannelConnection').RECONNECTING,m-1000),1000);return (c('React').createElement(c('ChatSidebarSheetChatReconnectMsg.react'),{isMessenger:l,msecs:m,onManuallyConnectClick:function(){return c('ChannelConnection').reconnect();}}));}return null;},_renderOffline:function(){return (c('React').createElement(c('ChatSidebarSheetChatOffline.react'),{onGoOnlineClick:function(l){i.log('sidebar_go_online');c('ChatVisibility').goOnline();}}));},_renderNotice:function(){return (c('React').createElement('div',null,h._("Les alertes sont d\u00e9sactiv\u00e9es durant l\u2019utilisation d\u2019un autre client de discussion instantan\u00e9e.")));}});f.exports=k;},null);
__d('MessengerSearchSource',['ChatSearchSource','MercuryConfig','MercuryIDs','MercuryParticipants','MercuryParticipantTypes','MercurySingletonProvider','SearchableEntry','emptyFunction','requireWeak'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=50;h=babelHelpers.inherits(k,c('ChatSearchSource'));i=h&&h.prototype;k.getForFBID=function(m){return l.getForFBID(m);};k.get=function(){return l.get();};function k(m){i.constructor.call(this,{queryRequests:[{uri:'/ajax/mercury/composer_query.php'}]});c('requireWeak')('OrderedFriendsList',function(o){return (o.getSearchableEntries(j,function(p){this.$MessengerSearchSource1=p;i.addLocalEntries.call(this,p);}.bind(this)));}.bind(this));var n=c('MercuryIDs').getParticipantIDFromUserID(m);c('MercuryParticipants').get(n,function(o){i.addLocalEntries.call(this,[new (c('SearchableEntry'))({uniqueID:o.fbid?o.fbid.toString():o.id,title:o.name,type:c('MercuryParticipantTypes').FRIEND,photo:o.big_image_src||o.image_src,uri:o.href,auxiliaryData:{isMessengerUser:o.is_messenger_user}})]);}.bind(this));}k.prototype.bootstrapImpl=function(m){i.bootstrapImpl.call(this,c('emptyFunction'));m();};k.prototype.searchImpl=function(m,n,o){o=o||{};if(m===''&&o.showDefaultEntries){n(this.$MessengerSearchSource1,m);var p=o&&o.onQueryFinished;p&&p(m);return;}o.threadLimit=c('MercuryConfig').MaxThreadResults;i.searchImpl.call(this,m,n,o);};var l=new (c('MercurySingletonProvider'))(k);f.exports=k;},null);
__d('MessengerSearchTypeahead.react',['cx','fbt','ix','AbstractTypeahead.react','Bootloader','Image.react','MercuryIDs','MercuryThreadIDMap','MercuryThreads','MercuryTypeaheadConstants','MercuryVanityIDMap','MessengerSearchSource','React','TypeaheadNavigation'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('MercuryThreadIDMap').get(),l=c('MercuryThreads').get(),m=c('React').PropTypes,n=j('/images/mercury/clients/messenger/threadlist/InboxThreadDismiss.png'),o=100,p=null,q=null,r=c('React').createClass({displayName:'MessengerSearchTypeahead',propTypes:{isFacebookChat:m.bool,isFocused:m.bool,maxEntries:m.number,onBlur:m.func,onChange:m.func,onClear:m.func,onFocus:m.func,onSelect:m.func.isRequired,onScrollIntoView:m.func,queryString:m.string,viewer:m.string.isRequired},getInitialState:function(){return {isLoading:false,orderable:!!q};},componentWillMount:function(){var s=c('TypeaheadNavigation').moveUp,t=c('TypeaheadNavigation').moveDown;if(this.props.isFacebookChat){s=c('TypeaheadNavigation').moveDown;t=c('TypeaheadNavigation').moveUp;}var u=function(v){var w=[];if(q)q.getEntryOrder(this.props.queryString).forEach(function(x){return w.push.apply(w,v.filter(function(y){return (q.areSectionsEqual(y.getType(),x));}));});return w;}.bind(this);this._moveUp=function(v){for(var w=arguments.length,x=Array(w>1?w-1:0),y=1;y<w;y++)x[y-1]=arguments[y];return s.apply(undefined,[u(v)].concat(x));};this._moveDown=function(v){for(var w=arguments.length,x=Array(w>1?w-1:0),y=1;y<w;y++)x[y-1]=arguments[y];return t.apply(undefined,[u(v)].concat(x));};},render:function(){var s,t=this.props.isFacebookChat?i._("Rechercher"):i._("Rechercher des personnes et des groupes");return (c('React').createElement('div',{className:"_3rh8"},c('React').createElement(c('AbstractTypeahead.react'),{autoHighlight:this.props.isFacebookChat,className:"_5iwm"+(this.props.isFocused||!!this.props.queryString?' '+"_5iwn":'')+(' '+"_150g"),inputClassName:"_3rhb",navigation:{moveUp:this._moveUp,moveDown:this._moveDown},onBlur:this.props.onBlur,onChange:this.props.onChange,onFocus:function(){this._handleInteraction();(s=this.props).onFocus.apply(s,arguments);}.bind(this),onMouseOver:this._handleInteraction,onClick:this._handleInteraction,onSelectAttempt:this._handleSelect,placeholder:t,presenter:{ViewRenderer:p,alwaysVisibleOnFocus:true,extraRendererProps:{className:"_11_d",hasHoverState:this.props.isFacebookChat,isLoading:this.state.isLoading,onScrollIntoView:this.props.onScrollIntoView,viewer:this.props.viewer},maxEntries:this.props.maxEntries||o,sortEntries:this._sortEntries,useLayer:false},queryString:this.props.queryString,role:'search',searchSource:c('MessengerSearchSource').getForFBID(this.props.viewer),searchSourceOptions:{onQueryFinished:this._handleQueryFinished,onQueryStarted:this._handleQueryStarted,showDefaultEntries:true},selectOnTab:true,spellCheck:false,showEntriesOnFocus:!this.props.isFacebookChat}),c('React').createElement(c('Image.react'),{onMouseDown:this.props.onClear,className:(!this.props.queryString?"hidden_elem":'')+(' '+"_2xme"),src:n})));},_handleInteraction:function(){if(!this.state.orderable)c('Bootloader').loadModules(["MessengerTypeaheadView.react","MessengerTypeaheadUtils"],function(s,t){p=s;q=t;this.setState({orderable:true});}.bind(this),'MessengerSearchTypeahead.react');},_handleQueryStarted:function(s){if(s===this.props.queryString)this.setState({isLoading:true});},_handleQueryFinished:function(s){if(s===this.props.queryString)this.setState({isLoading:false});},_sortEntries:function(s){return q?q.sortEntries(s,this.props.queryString):s;},_handleSelect:function(s){var t=s.getUniqueID(),u=s.getType(),v=s.getAuxiliaryData().alias;if(v)c('MercuryVanityIDMap').set(v,c('MercuryIDs').getParticipantIDFromUserID(t));if(u===c('MercuryTypeaheadConstants').THREAD_TYPE){k.getClientIDFromServerID(t,function(w){this.props.onSelect(w,u);}.bind(this));}else l.getThreadMeta(c('MercuryIDs').getThreadIDFromUserID(t),function(w){this.props.onSelect(w.thread_id,u);}.bind(this));}});f.exports=r;},null);
__d('ChatTypeaheadWrapper.react',['cx','Arbiter','Bootloader','ChatConfig','ChatOpenTab','ChatSidebarComposeLink.react','ChatSidebarSections','ChatSidebarSheet.react','MessengerSearchTypeahead.react','React','Run','emptyFunction','getActiveElement'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=40,j=c('ChatConfig').get('divebar_rounded_profile',false);function k(m){c('Arbiter').inform('sidebar/typeahead/active',m);}var l=c('React').createClass({displayName:'ChatTypeaheadWrapper',getInitialState:function(){return {height:0,value:'',isSearching:false,dropdownComponent:null};},componentDidMount:function(){if(this.props.isSidebar){c('Arbiter').subscribe('sidebar/resized',function(m,n){this.setState({height:n});}.bind(this));c('Run').onAfterLoad(function(){c('Bootloader').loadModules(["ChatSidebarDropdown.react","SidebarType","ChatSidebarActions"],function(m,n,o){this.setState({dropdownComponent:c('React').createElement(m,{sidebarType:n.SIDEBAR,onToggleSidebar:o.disable})});}.bind(this),'ChatTypeaheadWrapper.react');}.bind(this));}else c('Arbiter').subscribe('buddyList/resized',function(m,n){this.setState({height:n});}.bind(this));},componentWillUpdate:function(m,n){if(n.isSearching!==this.state.isSearching)k(n.isSearching);},render:function(){var m=this.state.height!=null?Math.floor((this.state.height-i*2)/i):null;return (c('React').createElement('div',{className:!j?"squareProfile":''},c('React').createElement(c('ChatSidebarSheet.react'),{className:'fbChatSidebarMessage'}),c('React').createElement(c('MessengerSearchTypeahead.react'),{isFacebookChat:true,isFocused:true,maxEntries:m,queryString:this.state.value,viewer:this.props.id,onBlur:function(){return this.setState({isSearching:false,value:''});}.bind(this),onChange:function(n){var o=n.target.value;this.setState({isSearching:o!=='',value:o});}.bind(this),onClear:c('emptyFunction'),onFocus:c('emptyFunction'),onScrollIntoView:c('emptyFunction'),onSelect:function(n,o){c('getActiveElement')().blur();c('ChatOpenTab').openTabByType(n,o,c('ChatSidebarSections').TYPEAHEAD);}}),this.props.isSidebar?c('React').createElement('div',{className:"_531b"},this.state.dropdownComponent,c('React').createElement(c('ChatSidebarComposeLink.react'),{className:"_3a-4 _5q85"})):null));}});f.exports=l;},null);
__d('ChatTypeaheadCore',['ChatTypeaheadWrapper.react','React','ReactDOM'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={init:function(i,j,k){c('ReactDOM').render(c('React').createElement(c('ChatTypeaheadWrapper.react'),{id:j,isSidebar:k}),i);}};f.exports=h;},null);
__d('NotificationBeeperItemCloseButton.react',['cx','fbt','React','XUIAbstractGlyphButton.react'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').createClass({displayName:'NotificationBeeperItemCloseButton',render:function(){return (c('React').createElement(c('XUIAbstractGlyphButton.react'),babelHelpers['extends']({},this.props,{className:"_3soc",title:i._("Fermer")})));}});f.exports=j;},null);
__d('FeedCommentBaseItemContents.react',['BootloadOnRender.react','JSResource','LazyComponent.react','React'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').createClass({displayName:'FeedCommentBaseItemContents',render:function(){return (c('React').createElement(c('BootloadOnRender.react'),{loader:c('JSResource')('FeedCommentBaseItemContentsImpl.react'),placeholder:c('React').createElement('div',null),component:c('React').createElement(c('LazyComponent.react'),{beep:this.props.beep,className:this.props.className,onHide:this.props.onHide,onReadyToHide:this.props.onReadyToHide,onPreventHide:this.props.onPreventHide,ref:'itemContents'})}));}});f.exports=h;},null);
__d('SyncRequestAcceptedMessage.react',['fbt','cx','React'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'SyncRequestAcceptedMessage',propTypes:{appName:j.string.isRequired,isSender:j.bool.isRequired,receiverName:j.string.isRequired,senderName:j.string.isRequired},render:function(){if(this.props.isSender){return (c('React').createElement('div',null,h._("{receiver} accepted your invite to play {app name}.",[h.param('receiver',c('React').createElement('span',{className:"_dg4"},this.props.receiverName)),h.param('app name',c('React').createElement('span',{className:"_dg5"},this.props.appName))])));}else return (c('React').createElement('div',null,h._("You accepted an invite from {sender} to play {app name}.",[h.param('sender',c('React').createElement('span',{className:"_dg4"},this.props.senderName)),h.param('app name',c('React').createElement('span',{className:"_dg5"},this.props.appName))])));}});f.exports=k;},null);
__d('SyncRequestCanceledMessage.react',['cx','fbt','React'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'SyncRequestCanceledMessage',propTypes:{appName:j.string.isRequired,isSender:j.bool.isRequired,receiverName:j.string.isRequired,senderName:j.string.isRequired},render:function(){if(this.props.isSender){return (c('React').createElement('div',null,i._("You canceled an invite to {receiver} to play {app name}.",[i.param('receiver',c('React').createElement('span',{className:"_dg4"},this.props.receiverName)),i.param('app name',c('React').createElement('span',{className:"_dg5"},this.props.appName))])));}else return (c('React').createElement('div',null,i._("{sender} canceled an invitation to play {app name}.",[i.param('sender',c('React').createElement('span',{className:"_dg4"},this.props.senderName)),i.param('app name',c('React').createElement('span',{className:"_dg5"},this.props.appName))])));}});f.exports=k;},null);
__d('SyncRequestExpiredMessage.react',['fbt','cx','React'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'SyncRequestExpiredMessage',propTypes:{appName:j.string.isRequired,isSender:j.bool.isRequired,receiverName:j.string.isRequired,senderName:j.string.isRequired},render:function(){if(this.props.isSender){return (c('React').createElement('div',null,h._("{receiver} missed your invite to play {app name}.",[h.param('receiver',c('React').createElement('span',{className:"_dg4"},this.props.receiverName)),h.param('app name',c('React').createElement('span',{className:"_dg5"},this.props.appName))])));}else return (c('React').createElement('div',null,h._("You missed an invite from {sender} to play {app name}.",[h.param('sender',c('React').createElement('span',{className:"_dg4"},this.props.senderName)),h.param('app name',c('React').createElement('span',{className:"_dg5"},this.props.appName))])));}});f.exports=k;},null);
__d('SyncRequestRejectedMessage.react',['cx','fbt','AsyncRequest','Link.react','React','URI'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'SyncRequestRejectedMessage',propTypes:{requestId:j.string.isRequired,app:j.object.isRequired,isSender:j.bool.isRequired,receiver:j.object.isRequired,sender:j.object.isRequired},render:function(){if(this.props.isSender){return (c('React').createElement('div',null,i._("{receiver} declined your invite to play {app_name}.",[i.param('receiver',c('React').createElement('span',{className:"_dg4"},this.props.receiver.name)),i.param('app_name',c('React').createElement('span',{className:"_dg5"},this.props.app.name))])));}else return (c('React').createElement('div',null,i._("You declined an invite from {sender} to play {app_name}.",[i.param('sender',c('React').createElement('span',{className:"_dg4"},this.props.sender.name)),i.param('app_name',c('React').createElement('span',{className:"_dg5"},this.props.app.name))]),c('React').createElement('div',{className:"_13n7"},c('React').createElement('div',null,c('React').createElement(c('Link.react'),{onClick:this._submitBlockApp},i._("Block {app}",[i.param('app',this.props.app.name)]))),c('React').createElement('div',null,c('React').createElement(c('Link.react'),{onClick:this._submitBlockUser},i._("Block requests from {sender}",[i.param('sender',this.props.sender.name)]))))));},_submitBlockApp:function(){var l=new (c('URI'))('/games/block_app/'),m=new (c('AsyncRequest'))().setURI(l);m.setData({app_id:this.props.app.id,source:'sync_request'});m.send();},_submitBlockUser:function(){var l=new (c('URI'))('/games/block_user/'),m=new (c('AsyncRequest'))().setURI(l);m.setData({app_id:this.props.app.id,blockee_uid:this.props.sender.id});m.send();}});f.exports=k;},null);
__d('SyncRequestTimer.react',['fbt','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes;function j(l){if(l){l=Math.ceil(l);var m=l%60;if(m<10)m='0'+m;var n=Math.floor(l/60);return n+':'+m;}else return "0:00";}var k=c('React').createClass({displayName:'SyncRequestTimer',propTypes:{timeRemaining:i.number.isRequired,isSender:i.bool.isRequired,receiverName:i.string.isRequired},render:function(){if(this.props.isSender){return (c('React').createElement('div',null,h._("({time_remaining} remaining)",[h.param('time_remaining',j(this.props.timeRemaining))])));}else return (c('React').createElement('div',null,h._("You have {time_remaining} to accept.",[h.param('time_remaining',j(this.props.timeRemaining))])));}});f.exports=k;},null);
__d('SyncRequestTitle.react',['fbt','cx','React'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'SyncRequestTitle',propTypes:{appName:j.string.isRequired,isSender:j.bool.isRequired,receiverName:j.string.isRequired,senderName:j.string.isRequired},render:function(){if(this.props.isSender){return (c('React').createElement('div',null,h._("Waiting for {receiver} to accept your invite to play {app_name}.",[h.param('receiver',c('React').createElement('span',{className:"_dg4"},this.props.receiverName)),h.param('app_name',c('React').createElement('span',{className:"_dg5"},this.props.appName))])));}else return (c('React').createElement('div',null,h._("{sender} wants to play {app_name} with you, right now.",[h.param('sender',c('React').createElement('span',{className:"_dg4"},this.props.senderName)),h.param('app_name',c('React').createElement('span',{className:"_dg5"},this.props.appName))])));}});f.exports=k;},null);
__d("XSyncRequestSubmitController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/platform\/games\/sync_requests\/submit\/",{request_id:{type:"Int",required:true},sender:{type:"Int",required:true},action:{type:"Int",required:true}});},null);
__d('SyncRequest.react',['cx','fbt','Arbiter','AsyncRequest','ChannelConstants','React','SyncRequestStatusEnum','SyncRequestTitle.react','SyncRequestAcceptedMessage.react','SyncRequestRejectedMessage.react','SyncRequestExpiredMessage.react','SyncRequestCanceledMessage.react','SyncRequestTimer.react','XUIButton.react','XSyncRequestSubmitController','getObjectValues'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'SyncRequest',propTypes:{app:j.object.isRequired,creationTime:j.number.isRequired,requestId:j.string.isRequired,receiver:j.object.isRequired,sender:j.object.isRequired,status:j.oneOf(c('getObjectValues')(c('SyncRequestStatusEnum'))).isRequired,timeout:j.number.isRequired,timeRemaining:j.number.isRequired,viewerId:j.number.isRequired,onStatusUpdate:j.func},componentWillMount:function(){if(this.props.status===c('SyncRequestStatusEnum').PENDING){var l=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('sync_request_updated'),function(o,p){p=p.obj;if(p.id.toString()!==this.props.requestId)return;this.setState({status:p.status});}.bind(this));this.setState({statusEvent:l});}var m=null;if(this.props.status===c('SyncRequestStatusEnum').PENDING){var n=function(){this.setState({time_remaining:this.state.time_remaining-1});if(this.state.time_remaining<=0){clearInterval(this.state.counter);var o={counter:null,time_remaining:0};if(this.state.status===c('SyncRequestStatusEnum').PENDING)o.status=c('SyncRequestStatusEnum').EXPIRED;this.setState(o);}};m=setInterval(n.bind(this),1000);}this.setState({time_remaining:this.props.timeRemaining,counter:m});},componentWillUnmount:function(){if(this.state.counter)clearInterval(this.state.counter);c('Arbiter').unsubscribe(this.state.statusEvent);},getInitialState:function(){return {buttonsDisabled:false,time:Date.now(),status:this.props.status,viewerIsSender:this.props.viewerId===this.props.sender.id};},componentDidUpdate:function(l,m){if(this.props.status!=c('SyncRequestStatusEnum').PENDING)this.state.status=this.props.status;if(this.props.onStatusUpdate)this.props.onStatusUpdate(this.state.status,m.status);},render:function(){var l;switch(this.state.status){case c('SyncRequestStatusEnum').PENDING:var m;if(!this.state.viewerIsSender){m=[c('React').createElement(c('XUIButton.react'),{use:'confirm',onClick:this._handleAccept,disabled:this.state.buttonsDisabled,label:i._("Accept")}),c('React').createElement(c('XUIButton.react'),{use:'default',onClick:this._handleReject,disabled:this.state.buttonsDisabled,label:i._("Decline")})];}else m=c('React').createElement(c('XUIButton.react'),{use:'default',onClick:this._handleCancel,disabled:this.state.buttonsDisabled,label:i._("Cancel")});l=c('React').createElement('div',null,c('React').createElement('div',{className:"_372m"},c('React').createElement(c('SyncRequestTitle.react'),{appName:this.props.app.name,isSender:this.state.viewerIsSender,receiverName:this.props.receiver.name,senderName:this.props.sender.name})),c('React').createElement('div',{className:"_372n"},c('React').createElement(c('SyncRequestTimer.react'),{isSender:this.state.viewerIsSender,timeRemaining:this.state.time_remaining,receiverName:this.props.receiver.name})),c('React').createElement('div',{className:"_372o"},m));break;case c('SyncRequestStatusEnum').ACCEPTED:l=c('React').createElement('div',{className:"_372p mvs"},c('React').createElement(c('SyncRequestAcceptedMessage.react'),{appName:this.props.app.name,isSender:this.state.viewerIsSender,receiverName:this.props.receiver.name,senderName:this.props.sender.name}));break;case c('SyncRequestStatusEnum').REJECTED:l=c('React').createElement('div',{className:"_372p mvs"},c('React').createElement(c('SyncRequestRejectedMessage.react'),{requestId:this.props.requestId,app:this.props.app,isSender:this.state.viewerIsSender,receiver:this.props.receiver,sender:this.props.sender}));break;case c('SyncRequestStatusEnum').EXPIRED:l=c('React').createElement('div',{className:"_372p mvs"},c('React').createElement(c('SyncRequestExpiredMessage.react'),{appName:this.props.app.name,isSender:this.state.viewerIsSender,receiverName:this.props.receiver.name,senderName:this.props.sender.name}));break;case c('SyncRequestStatusEnum').CANCELED:l=c('React').createElement('div',{className:"_372p mvs"},c('React').createElement(c('SyncRequestCanceledMessage.react'),{appName:this.props.app.name,isSender:this.state.viewerIsSender,receiverName:this.props.receiver.name,senderName:this.props.sender.name}));break;default:throw new Error('The request status `%s` is unknown.',this.state.status);}return (c('React').createElement('div',{className:"_372q"},l));},_handleAccept:function(){this._handleStatusUpdate(c('SyncRequestStatusEnum').ACCEPTED);var l=window.open(this.props.app.uri);if(l)l.focus();},_handleReject:function(){this._handleStatusUpdate(c('SyncRequestStatusEnum').REJECTED);},_handleCancel:function(){this._handleStatusUpdate(c('SyncRequestStatusEnum').CANCELED);},_handleStatusUpdate:function(l){this.setState({status:l,buttonsDisabled:true});var m=c('XSyncRequestSubmitController').getURIBuilder().setInt('request_id',this.props.requestId).setInt('sender',this.props.sender.id).setInt('action',l).getURI();new (c('AsyncRequest'))().setURI(m).setHandler(function(n){this.setState({status:l});}.bind(this)).setErrorHandler(function(n){this.setState({buttonsDisabled:false});}.bind(this)).send();}});f.exports=k;},null);
__d("XQuickPromotionSimpleLoggingController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/qp\/action\/log\/",{qp_id:{type:"Int",required:true},qp_action:{type:"Enum",enumType:1},qp_instance_log_data:{type:"StringToStringMap",defaultValue:{}},qp_event:{type:"String"}});},null);
__d('QPRenderer',['$','CSS','XQuickPromotionSimpleLoggingController','AsyncSignal'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=function(m,event,n){var o=c('XQuickPromotionSimpleLoggingController').getURIBuilder().setInt('qp_id',m).setString('qp_event',event).setStringToStringMap('qp_instance_log_data',n).getURI();new (c('AsyncSignal'))(o,{}).send();},i=function(m,n,o){var p=c('XQuickPromotionSimpleLoggingController').getURIBuilder().setInt('qp_id',m).setEnum('qp_action',n).setStringToStringMap('qp_instance_log_data',o).getURI();new (c('AsyncSignal'))(p,{}).send();},j=function(m,n,o,p,q,r){l(m,o,c('$')(p),r,function(){if(q)c('CSS').hide(n);});},k=function(m,n,o){n.show();h(m,'view',{});n.subscribe('cancel',function(){h(m,'dialog_cancel',{});});for(var p=0;p<o.length;p++){var q=o[p],r=c('$')(q.element_id);l(m,q.action,r,q.instance_log_data,function(){if(q.should_close)n.hide();});if(q.action=='primary')r.focus();}},l=function(m,n,o,p,q){o.addEventListener('click',function(){var r=c('XQuickPromotionSimpleLoggingController').getURIBuilder().setInt('qp_id',m).setEnum('qp_action',n).setStringToStringMap('qp_instance_log_data',p).getURI();new (c('AsyncSignal'))(r,{}).send();q();});};g.setAction=j;g.setDialogActionsAndShow=k;g.logAction=i;g.logEvent=h;},null);
__d("XGamesHideableXOutAsyncController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/games\/async\/xout\/hide\/",{unit_type:{type:"String"},fbs:{type:"Int"},app_id:{type:"Int"},extra_data:{type:"String"}});},null);
__d('GamesUninstallXOut.react',['cx','AsyncRequest','CSS','DOMContainer.react','Dialog','GamesXOut.react','React','ReactDOM','URI','XGamesHideableXOutAsyncController'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'GamesUninstallXOut',propTypes:{unitType:i.string.isRequired,appID:i.string.isRequired,domChild:i.any.isRequired,extraData:i.string.isRequired,fbs:i.number.isRequired},getInitialState:function(){return {pending:false};},statics:{appUninstalled:function(k){c('CSS').addClass(k,"_4ksu");}},_appUninstalled:function(){var k=c('XGamesHideableXOutAsyncController').getURIBuilder().setInt('app_id',this.props.appID).setString('extra_data',this.props.extraData).setString('unit_type',this.props.unitType).setInt('fbs',this.props.fbs).getURI();this._request=new (c('AsyncRequest'))(k).setMethod('POST');this._request.send();},_handleXOut:function(){var k=new (c('URI'))('/ajax/settings/apps/delete_app.php').setQueryData({app_id:this.props.appID,legacy:false,dialog:true,xout:true});new (c('Dialog'))().setAsync(new (c('AsyncRequest'))(k).setRelativeTo(c('ReactDOM').findDOMNode(this))).setCausalElement(c('ReactDOM').findDOMNode(this)).show();},render:function(){return (c('React').createElement(c('GamesXOut.react'),{onClick:this._handleXOut},c('React').createElement(c('DOMContainer.react'),null,this.props.domChild)));}});f.exports=j;},null);
__d("XGamesGripperNoteUpdaterController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/async\/games\/gripper_note_viewed\/",{});},null);
__d('SidebarAppTickerResizer',['cx','Animation','Arbiter','AsyncRequest','ChatSidebarActions','ChatSidebarStore','CSS','debounce','Event','SidebarType','SimpleDrag','TickerController','$','ge','queryThenMutateDOM','XGamesGripperNoteUpdaterController'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=1e-07,j=1,k=85,l=173,m=165,n=300,o=46,p=90,q=82,r=150;function s(t,u,v,w,x,y){'use strict';this.$SidebarAppTickerResizer1=c('$')('pagelet_ticker');this.$SidebarAppTickerResizer2=c('$')('pagelet_canvas_nav_content');this.$SidebarAppTickerResizer3=this.$SidebarAppTickerResizer1.parentNode;this.$SidebarAppTickerResizer4=x;this.$SidebarAppTickerResizer5=y;var z=parseInt(v,10);if(!isNaN(z)){if(z>k)if(z!=this.$SidebarAppTickerResizer6())v=this.$SidebarAppTickerResizer6()+'px';this.$SidebarAppTickerResizer7(z);}this.$SidebarAppTickerResizer2.style.height=v;this.$SidebarAppTickerResizer8(t,u);if(v===null)if(w!==null){this.$SidebarAppTickerResizer9();this.$SidebarAppTickerResizer10(this.$SidebarAppTickerResizer6());}else c('Arbiter').subscribe('AppsDivebar/show-apps',this.$SidebarAppTickerResizer9.bind(this));if(!x){this.$SidebarAppTickerResizer11();c('CSS').hide(t);}c('Arbiter').subscribe('ChatSidebarDropdown/closeTicker',this.$SidebarAppTickerResizer11.bind(this));c('Arbiter').subscribe('ChatSidebarDropdown/openTicker',this.$SidebarAppTickerResizer12.bind(this));c('Arbiter').subscribe('sidebar/visibility',function(fa,ga){if(ga)this.$SidebarAppTickerResizer13();}.bind(this));if(w){var aa=c('ge')('pagelet_ticker'),ba=aa&&aa.parentNode,ca,da=function(){w.hide();if(ca)ca.unsubscribe();},ea=function(){if(!c('CSS').shown(ba))return;var fa=c('XGamesGripperNoteUpdaterController').getURIBuilder().getURI();new (c('AsyncRequest'))().setURI(fa).send();w.show();if(ca)ca.unsubscribe();ca=c('Arbiter').subscribe('sidebar/visibility',function(ga,ha){if(!ha)da();});};if(ba&&c('CSS').shown(ba)){ea();}else ca=c('Arbiter').subscribe('ticker/show',ea);}this.$SidebarAppTickerResizer14=c('debounce')(this.$SidebarAppTickerResizer9.bind(this),200);c('Event').listen(window,'resize',this.$SidebarAppTickerResizer14);c('Arbiter').inform('Ticker/resized');}s.prototype.$SidebarAppTickerResizer13=function(){'use strict';c('TickerController').show(this.$SidebarAppTickerResizer1);};s.prototype.$SidebarAppTickerResizer9=function(t){'use strict';c('queryThenMutateDOM')(function(){this.$SidebarAppTickerResizer15();}.bind(this),function(){var u=Math.round(parseFloat(this.$SidebarAppTickerResizer1.style.height));if(u>Math.round(this.$SidebarAppTickerResizer16())||this.$SidebarAppTickerResizer17&&this.$SidebarAppTickerResizer17>j){var v=this.$SidebarAppTickerResizer17/this.$SidebarAppTickerResizer18*100,w=this.$SidebarAppTickerResizer19(0,this.$SidebarAppTickerResizer16()-v);if(!(t&&t.type==='resize'))this.$SidebarAppTickerResizer20(w);c('ChatSidebarActions').show();}}.bind(this));};s.prototype.$SidebarAppTickerResizer16=function(){'use strict';if(!this.$SidebarAppTickerResizer4)return 0;if(c('ChatSidebarStore').getVisibleType()!==c('SidebarType').SIDEBAR)return p;return Math.min(p,(this.$SidebarAppTickerResizer18-this.$SidebarAppTickerResizer21-q)*100/this.$SidebarAppTickerResizer18);};s.prototype.$SidebarAppTickerResizer8=function(t,u){'use strict';var v=new (c('SimpleDrag'))(t);v.subscribe('start',this.$SidebarAppTickerResizer22.bind(this));v.subscribe(['update','end'],this.$SidebarAppTickerResizer23.bind(this));var w=new (c('SimpleDrag'))(u);w.subscribe('start',this.$SidebarAppTickerResizer22.bind(this));w.subscribe('update',this.$SidebarAppTickerResizer24.bind(this));w.subscribe('end',this.$SidebarAppTickerResizer25.bind(this));};s.prototype.$SidebarAppTickerResizer22=function(t,event){'use strict';this.$SidebarAppTickerResizer26=event.clientY;this.$SidebarAppTickerResizer15();this.$SidebarAppTickerResizer27();};s.prototype.$SidebarAppTickerResizer15=function(){'use strict';this.$SidebarAppTickerResizer21=this.$SidebarAppTickerResizer2.offsetTop;this.$SidebarAppTickerResizer28=this.$SidebarAppTickerResizer1.offsetHeight;this.$SidebarAppTickerResizer18=this.$SidebarAppTickerResizer3.offsetHeight;this.$SidebarAppTickerResizer17=this.$SidebarAppTickerResizer2.offsetHeight;this.$SidebarAppTickerResizer29=this.$SidebarAppTickerResizer17;};s.prototype.$SidebarAppTickerResizer27=function(){'use strict';c('CSS').addClass(this.$SidebarAppTickerResizer3,"_4vfq");};s.prototype.$SidebarAppTickerResizer30=function(){'use strict';c('CSS').removeClass(this.$SidebarAppTickerResizer3,"_4vfq");};s.prototype.$SidebarAppTickerResizer23=function(t,event){'use strict';var u=this.$SidebarAppTickerResizer17/this.$SidebarAppTickerResizer18*100,v=this.$SidebarAppTickerResizer19(event.clientY-this.$SidebarAppTickerResizer26,this.$SidebarAppTickerResizer16()-u);if(t=='end'){this.$SidebarAppTickerResizer30();this.$SidebarAppTickerResizer20(v);}c('ChatSidebarActions').show();};s.prototype.$SidebarAppTickerResizer24=function(t,event){'use strict';var u=-this.$SidebarAppTickerResizer17,v=this.$SidebarAppTickerResizer6()-this.$SidebarAppTickerResizer17,w=this.$SidebarAppTickerResizer31(event.clientY-this.$SidebarAppTickerResizer26,u,v);this.$SidebarAppTickerResizer19(-w,this.$SidebarAppTickerResizer16());this.$SidebarAppTickerResizer29=this.$SidebarAppTickerResizer17+w;this.$SidebarAppTickerResizer29=Math.max(j,this.$SidebarAppTickerResizer29);this.$SidebarAppTickerResizer2.style.height=this.$SidebarAppTickerResizer29+'px';};s.prototype.$SidebarAppTickerResizer25=function(t,event){'use strict';var u=this.$SidebarAppTickerResizer29,v=this.$SidebarAppTickerResizer32(this.$SidebarAppTickerResizer29);this.$SidebarAppTickerResizer7(v);var w=this.$SidebarAppTickerResizer19(this.$SidebarAppTickerResizer17-v,this.$SidebarAppTickerResizer16());if(this.$SidebarAppTickerResizer17!=v){this.$SidebarAppTickerResizer10(v);this.$SidebarAppTickerResizer20(w);}new (c('Animation'))(this.$SidebarAppTickerResizer2).from('height',u).to('height',v).duration(n).go();};s.prototype.$SidebarAppTickerResizer7=function(t){'use strict';if(!this.$SidebarAppTickerResizer5)return;var u="_3qrt",v=document.getElementsByClassName(u),w='';if(t==this.$SidebarAppTickerResizer33()){w='inline';}else w='';for(var x=0;x<v.length;x++)v[x].style.display=w;};s.prototype.$SidebarAppTickerResizer19=function(t,u){'use strict';var v=this.$SidebarAppTickerResizer28+t,w=v/this.$SidebarAppTickerResizer18*100;w=Math.max(i,Math.min(u,w));this.$SidebarAppTickerResizer1.style.height=w+'%';if(w!=i){c('CSS').removeClass(this.$SidebarAppTickerResizer1,'hidden_elem');this.$SidebarAppTickerResizer13();}return w;};s.prototype.$SidebarAppTickerResizer32=function(t){'use strict';var u=this.$SidebarAppTickerResizer33(),v=this.$SidebarAppTickerResizer6();return t<v-o?t<u-o?j:u:v;};s.prototype.$SidebarAppTickerResizer33=function(){'use strict';return k;};s.prototype.$SidebarAppTickerResizer6=function(){'use strict';if(this.$SidebarAppTickerResizer5){return m;}else return l;};s.prototype.$SidebarAppTickerResizer34=function(t){'use strict';var u=this.$SidebarAppTickerResizer6();return t<0?j:t>u?u:t;};s.prototype.$SidebarAppTickerResizer31=function(t,u,v){'use strict';return t<u?u:t>v?v:t;};s.prototype.$SidebarAppTickerResizer20=function(t){'use strict';new (c('AsyncRequest'))('/ajax/feed/ticker/resize').setData({height:''+t}).setMethod('POST').send();c('Arbiter').inform('Ticker/resized');};s.prototype.$SidebarAppTickerResizer10=function(t){'use strict';new (c('AsyncRequest'))('/ajax/feed/apps/resize').setData({height:''+t}).setMethod('POST').send();};s.prototype.$SidebarAppTickerResizer35=function(t){'use strict';var u=this.$SidebarAppTickerResizer28,v=this.$SidebarAppTickerResizer18*t/100;new (c('Animation'))(this.$SidebarAppTickerResizer1).from('height',u).to('height',v).duration(r).ondone(function(){this.$SidebarAppTickerResizer1.style.height=t+'%';this.$SidebarAppTickerResizer20(t===0?'0.0':t);c('ChatSidebarActions').show();}.bind(this)).go();};s.prototype.$SidebarAppTickerResizer11=function(){'use strict';this.$SidebarAppTickerResizer15();this.$SidebarAppTickerResizer35(0);};s.prototype.$SidebarAppTickerResizer12=function(){'use strict';this.$SidebarAppTickerResizer1.style.height='40px';c('TickerController').show(this.$SidebarAppTickerResizer1,function(){this.$SidebarAppTickerResizer15();var t=(this.$SidebarAppTickerResizer18-this.$SidebarAppTickerResizer21-q-this.$SidebarAppTickerResizer17)*50/this.$SidebarAppTickerResizer18;this.$SidebarAppTickerResizer35(t);}.bind(this));};f.exports=s;},null);
__d('JewelQPLogging',['QPRenderer'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=false,i=null,j=false;function k(){if(j)return;if(h&&i){j=true;c('QPRenderer').logEvent(i.promotion_id,'view',i.instance_log_data?i.instance_log_data:{});}}var l={onJewelOpened:function(){h=true;k();},updateQPLogData:function(m){i=m;k();}};f.exports=l;},null);
__d('RequestsJewelStore',['Arbiter','ArbiterMixin','ChannelConstants'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=babelHelpers['extends']({},c('ArbiterMixin'),{_initialized:false,_count:0,_requestList:{},addFriendRequests:function(i){Object.assign(this._requestList,i);},getRequestListKeys:function(){return Object.keys(this._requestList);},removeRequest:function(i){delete this._requestList[i];},getRequestCount:function(i){return this.getRequestListKeys().length;},decrementCount:function(){this.setCount(Math.max(0,this._count-1));},setCount:function(i){c('Arbiter').inform('jewel/count-updated',{jewel:'requests',count:i},c('Arbiter').BEHAVIOR_STATE);},setupListeners:function(){if(this._initialized)return;this._initialized=true;c('Arbiter').subscribe('jewel/count-updated',function(i,j){j.jewel==='requests'&&this._updateCount(j.count);}.bind(this));c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('jewel_requests_add'),function(i,j){return this._addRequest(j);}.bind(this));c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('jewel_friending_notifs'),function(i,j){return this._addNotification(j);}.bind(this));c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('jewel_requests_remove_old'),function(i,j){return this._removeOldRequest(j);}.bind(this));c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('friend_requests_seen'),function(i,j){return this.setCount(0);}.bind(this));},_updateCount:function(i){var j=this._count!==i;this._count=i;if(j)this.inform('countUpdated',i);},_addRequest:function(i){if(!i)return;var j=i.obj,k=j.from,l=j.suggester,m=this._requestList[k];if(!m)this.setCount(this._count+1);var n=m?m.type:null,o=n===19&&!l;this.inform('addRequest',{shouldReplace:o,previousType:n});},_addNotification:function(i){if(!i||i.obj.notif_type!=='friend_confirmed')return;this.inform('addNotification');},_removeOldRequest:function(i){if(!i)return;var j=this._requestList[i.obj.from];if(!j)return;this.inform('removeOldRequest',j);}});f.exports=h;},null);
__d('RequestsJewelController',['invariant','Promise','Arbiter','AsyncRequest','AsyncSignal','CSS','DOM','DOMQuery','Event','JewelConstants','JewelQPLogging','MarauderLogger','Parent','RequestsJewelStore','ScrollableArea','ge','getElementPosition','getViewportDimensions','requireWeak','throttle'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=null;c('requireWeak')('FriendBrowserCheckboxController',function(o){return i=o;});var j=31,k=499,l=30,m=160;n.$RequestsJewelController10=null;n.getInstance=function(){'use strict';return this.$RequestsJewelController10;};n.updateFromDOM=function(){'use strict';var o=this.getInstance();if(o)o.fromDom();};n.setupScroll=function(){'use strict';var o=this.getInstance();if(o)o.setupScroll();};n.setInitialHeight=function(){'use strict';var o=this.getInstance();if(o)o.updateHeight();};n.maybeLoadJewel=function(){'use strict';var o=this.getInstance();if(o)o.maybeLoadJewel();};n.create=function(o,p,q){'use strict';!!this.$RequestsJewelController10?h(0):void 0;return this.$RequestsJewelController10=new n(o,p,q);};function n(o,p,q){'use strict';this.$RequestsJewelController3=p;this.$RequestsJewelController2=q;this.$RequestsJewelController1=o;this.$RequestsJewelController5=-1;this.$RequestsJewelController9=c('Promise').resolve(true);this.$RequestsJewelController7=c('throttle').acrossTransitionsWithBlocking(function(){return this.$RequestsJewelController11({log_impressions:true});}.bind(this),5000);c('RequestsJewelStore').subscribe('addRequest',this.$RequestsJewelController12.bind(this));c('RequestsJewelStore').subscribe('addNotification',function(){return this.$RequestsJewelController13();}.bind(this));c('RequestsJewelStore').subscribe('removeOldRequest',this.$RequestsJewelController14.bind(this));c('RequestsJewelStore').setupListeners();this.setupScroll();this.$RequestsJewelController15();this.$RequestsJewelController16();this.$RequestsJewelController17();}n.prototype.fromDom=function(){'use strict';var o={};c('DOMQuery').scry(this.$RequestsJewelController1,'li.objectListItem').forEach(function(p){var q=p.getAttribute('id');if(q){var r=this.$RequestsJewelController18(q);if(r&&r.requester)o[r.requester]=r;}}.bind(this));c('RequestsJewelStore').addFriendRequests(o);this.$RequestsJewelController19();};n.prototype.maybeLoadJewel=function(){'use strict';if(this.$RequestsJewelController8){this.$RequestsJewelController8=false;this.openHandler();}};n.prototype.updateHeight=function(){'use strict';var o=this.$RequestsJewelController20();if(o)o.style.height=this.$RequestsJewelController21()+'px';};n.prototype.markSeen=function(){'use strict';this.$RequestsJewelController9.done(function(){var o=c('DOMQuery').scry(this.$RequestsJewelController1,'li[id]')[0];new (c('AsyncSignal'))('/ajax/gigaboxx/endpoint/UpdateLastSeenTime.php',{folder:this.$RequestsJewelController2,first_item:o.getAttribute('id')}).send();}.bind(this));};n.prototype.openHandler=function(){'use strict';c('Arbiter').inform('requestsJewel/opened');var o=c('ge')('fbRequestsJewelLoading'),p=this.$RequestsJewelController20();if(!o&&!p){this.$RequestsJewelController8=true;}else if(o){this.$RequestsJewelController7();}else{var q=c('RequestsJewelStore').getRequestListKeys();if(q.length>0)new (c('AsyncRequest'))().setAllowCrossPageTransition(true).setURI('/friends/requests/log_impressions').setData({ids:q.join(','),ref:'jewel'}).send();}p&&c('ScrollableArea').poke(p);c('JewelQPLogging').onJewelOpened();};n.prototype.closeHandler=function(){'use strict';c('Arbiter').inform('requestsJewel/closed');c('DOMQuery').scry(this.$RequestsJewelController1,'li.jewelItemNew').forEach(function(o){c('CSS').removeClass(o,'jewelItemNew');});};n.prototype.setupScroll=function(){'use strict';var o=this.$RequestsJewelController20();if(o){this.$RequestsJewelController6=this.$RequestsJewelController22();this.$RequestsJewelController4=0;c('ScrollableArea').getInstance(o).subscribe('scroll',this.$RequestsJewelController23.bind(this));this.$RequestsJewelController24();}};n.prototype.$RequestsJewelController15=function(){'use strict';c('Event').listen(this.$RequestsJewelController1,'submit',function(o){var p=c('Parent').byClass(o.getTarget(),'objectListItem');if(p){c('CSS').removeClass(p,'jewelItemNew');c('CSS').addClass(p,'jewelItemResponded');}});};n.prototype.$RequestsJewelController16=function(){'use strict';c('Event').listen(window,'resize',c('throttle').acrossTransitions(function(){this.updateHeight();}.bind(this)));};n.prototype.$RequestsJewelController17=function(){'use strict';c('Arbiter').subscribe('pymk-x-out',function(o,p){var q=p.location;if(q==='pymk_jewel_first_page'||q==='pymk_jewel')this.$RequestsJewelController24();}.bind(this));};n.prototype.$RequestsJewelController25=function(o){'use strict';var p=parseInt(o,10);return !isNaN(p)?p:null;};n.prototype.$RequestsJewelController18=function(o){'use strict';var p=o.match(/^(\d+)_(\d+)/);if(!p)return null;return {requester:this.$RequestsJewelController25(p[1]),type:this.$RequestsJewelController25(p[2])};};n.prototype.$RequestsJewelController26=function(o,p){'use strict';if(o==null||p==null)return null;return o+'_'+p;};n.prototype.$RequestsJewelController20=function(){'use strict';return c('DOMQuery').scry(this.$RequestsJewelController1,'.uiScrollableArea')[0];};n.prototype.$RequestsJewelController22=function(){'use strict';return c('DOMQuery').scry(this.$RequestsJewelController1,'.uiScrollableAreaWrap')[0];};n.prototype.$RequestsJewelController23=function(){'use strict';var o=c('DOMQuery').scry(this.$RequestsJewelController6,'.uiMorePager').pop();if(o){var p=c('getElementPosition')(o).y;if(p>0)c('CSS').addClass(this.$RequestsJewelController20(),'contentAfter');var q=c('DOMQuery').find(o,'a');if(!q)return;var r=c('getElementPosition')(q).y;if(r===this.$RequestsJewelController4)return;var s=c('getElementPosition')(this.$RequestsJewelController6),t=s.y+s.height;if(r-300<t&&r>0){this.$RequestsJewelController4=r;var u=q.getAttribute('ajaxify');if(u){new (c('AsyncRequest'))(u).setRelativeTo(q).setStatusElement(c('Parent').byClass(q,'stat_elem')).send();}else if(i)i.getInstance('jewel').showMore();}}this.$RequestsJewelController24();};n.prototype.$RequestsJewelController24=function(){'use strict';if(!this.$RequestsJewelController6)return;var o=c('getElementPosition')(this.$RequestsJewelController6),p=o.y+o.height,q=c('DOMQuery').scry(this.$RequestsJewelController1,'li.friendBrowserListUnit'),r=q.length-1;while(r>this.$RequestsJewelController5){var s=c('getElementPosition')(q[r]),t=s.y,u=t+s.height;if(t>0&&u<=p)break;r-=1;}var v=r;while(r>this.$RequestsJewelController5){var w=c('DOMQuery').find(q[r],'input.friendBrowserID'),x=parseInt(w.value,10);c('MarauderLogger').log('regular_pymk_imp',undefined,{pymk_id:x,pymk_location:'pymk_jewel'});r-=1;}this.$RequestsJewelController5=Math.max(this.$RequestsJewelController5,v);};n.prototype.$RequestsJewelController11=function(){var o=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];'use strict';this.$RequestsJewelController9=new (c('Promise'))(function(p,q){var r=!c('ge')('fbRequestsJewelLoading');new (c('AsyncRequest'))().setURI('/ajax/requests/loader/').setData(babelHelpers['extends']({},o,{reloadcontent:r})).setFinallyHandler(function(s){if(!s.getError()){p(true);}else q();}).send();});};n.prototype.$RequestsJewelController13=function(){'use strict';if(this.$RequestsJewelController3())return;this.$RequestsJewelController11();};n.prototype.$RequestsJewelController12=function(o,p){var q=p.shouldReplace,r=p.previousType;'use strict';if(!q&&(r||this.$RequestsJewelController3()))return;this.$RequestsJewelController11();};n.prototype.$RequestsJewelController14=function(o,p){var q=p.requester,r=p.type;'use strict';if(this.$RequestsJewelController3()||c('ge')('fbRequestsJewelLoading')!=null)return;var s=this.$RequestsJewelController26(q,r),t=s&&c('ge')(s);if(t){if(c('CSS').hasClass(t,'jewelItemNew'))c('RequestsJewelStore').decrementCount();if(!c('CSS').hasClass(t,'jewelItemResponded')){c('DOM').remove(t);c('RequestsJewelStore').removeRequest(q);this.$RequestsJewelController19();}}};n.prototype.$RequestsJewelController19=function(){'use strict';c('DOMQuery').scry(this.$RequestsJewelController1,'li.empty').forEach(function(o){c('CSS').conditionShow(o,c('RequestsJewelStore').getRequestCount()<=0);});};n.prototype.$RequestsJewelController21=function(){'use strict';return Math.min(Math.max(c('getViewportDimensions')().height-m,l),c('JewelConstants').FLYOUT_MAX_HEIGHT||k)+j;};f.exports=n;},null);
__d('NotificationJewelReminderLoader',['JSResource'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();f.exports={init:function(h){c('JSResource')('NotificationJewelReminder').load().done(function(i){new i(h);});}};},null);
__d('SyncRequestNotificationBeeperItemContents.react',['cx','Animation','Image.react','ImageBlock.react','NotificationBeeperItemCloseButton.react','NotificationUserActions','React','ReactDOM','SyncRequest.react','SyncRequestStatusEnum'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').createClass({displayName:'SyncRequestNotificationBeeperItemContents',_markAsRead:function(){c('NotificationUserActions').markNotificationsAsRead([this.props.beep.notificationID]);this.props.onHide();},_onClose:function(){this._markAsRead();this.props.onHide();},_doFlash:function(){new (c('Animation'))(c('ReactDOM').findDOMNode(this.refs.inner)).from('opacity','0').to('opacity','1').duration(200).go();},componentDidMount:function(){if(this.props.beep.rendererData.status!=c('SyncRequestStatusEnum').PENDING)this.props.onReadyToHide(this.props.beep.notificationID);},componentDidUpdate:function(j){if(this.props.beep.rendererData.status!=c('SyncRequestStatusEnum').PENDING&&j.beep.rendererData.status==c('SyncRequestStatusEnum').PENDING)this.props.onReadyToHide(this.props.beep.notificationID);},onRequestStatusUpdate:function(j,k){if(j!=c('SyncRequestStatusEnum').PENDING&&k==c('SyncRequestStatusEnum').PENDING)this.props.onReadyToHide(this.props.beep.notificationID);},render:function(){var j=this.props.beep,k=j.rendererData;return (c('React').createElement('div',{ref:'inner',className:this.props.className},c('React').createElement(c('NotificationBeeperItemCloseButton.react'),{onClick:this._onClose}),c('React').createElement(c('ImageBlock.react'),{className:"_3soj"},c('React').createElement(c('Image.react'),{src:j.actors[0].profile_picture.uri,className:"_3sok"}),c('React').createElement('div',{className:"_3sol"},c('React').createElement(c('SyncRequest.react'),{app:k.app,creationTime:k.creation_time,requestId:k.id.toString(),receiver:k.receiver,sender:k.sender,status:k.status,timeout:k.timeout,timeRemaining:k.time_remaining,viewerId:k.receiver.id,onStatusUpdate:this.onRequestStatusUpdate})))));}});f.exports=i;},null);
__d('LiveMessageReceiver',['Arbiter','ChannelConstants','emptyFunction','shield'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){this.eventName=i;this.subs=null;this.handler=c('emptyFunction');this.shutdownHandler=null;this.registered=false;this.appId=1;}Object.assign(h,{getAppMessageType:function(i,j){return 'live_message/'+i+':'+j;},route:function(i){var j=function(k){var l=h.getAppMessageType(i.app_id,i.event_name);c('Arbiter').inform(l,k,c('Arbiter').BEHAVIOR_PERSISTENT);};j(i.response);}});Object.assign(h.prototype,{setAppId:function(i){this.appId=i;return this;},setHandler:function(i){this.handler=i;this._dirty();return this;},setRestartHandler:c('emptyFunction'),setShutdownHandler:function(i){this.shutdownHandler=c('shield')(i);this._dirty();return this;},_dirty:function(){if(this.registered){this.unregister();this.register();}},register:function(){var i=function(k,l){return this.handler(l);}.bind(this),j=h.getAppMessageType(this.appId,this.eventName);this.subs={};this.subs.main=c('Arbiter').subscribe(j,i);if(this.shutdownHandler)this.subs.shut=c('Arbiter').subscribe(c('ChannelConstants').ON_SHUTDOWN,this.shutdownHandler);this.registered=true;return this;},unregister:function(){if(!this.subs)return this;for(var i in this.subs)if(this.subs[i])this.subs[i].unsubscribe();this.subs=null;this.registered=false;return this;}});f.exports=h;},null);
__d('initLiveMessageReceiver',['Arbiter','ChannelConstants','LiveMessageReceiver'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('app_msg'),function(h,i){c('LiveMessageReceiver').route(i.obj);});},null);
__d('Carousel',['cx','Animation','CSS','Ease','Locale','Slideshow','Style','shield'],function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('Locale').isRTL()?'right':'left',l=c('Ease').sineInOut;i=babelHelpers.inherits(m,c('Slideshow'));j=i&&i.prototype;function m(n,o){'use strict';j.constructor.call(this,n,o);this.subscribe('items_updated',this._updateItemState.bind(this));}m.prototype._updateItemState=function(n,o){'use strict';this._setContainerPos(n);c('Style').set(this._container,'width',this._items.length*this._config.width+'px');};m.prototype._updateArrowState=function(n){'use strict';if(!this._config.arrows)return;var o=this._config.wrap,p=this._items.length,q=Math.floor(p/this._config.photosperframe);c('CSS').conditionClass(this._arrowNext,"_2xo",q===1||!o&&n===q-1);c('CSS').conditionClass(this._arrowPrev,"_2xo",q===1||!o&&n===0);};m.prototype._animate=function(n,o){'use strict';var p=n===-1?this._items.length-1:n,q=0;if(this._config.peek_with_offset){q=-n*(this._config.width-this._config.peek*2);if(n>0)q=q+this._config.peek-n*(this._config.item_margin/2);if(n===this._items.length-1)q+=this._config.peek;}else q=-n*this._config.width;this._animating=true;this.inform('page_start',p);new (c('Animation'))(this._container).to(k,q).duration(this._config.animationDuration).ease(l).ondone(o).go();};m.prototype._setContainerPos=function(n){'use strict';c('Style').set(this._container,k,-n*this._config.width+'px');};m.prototype._animateTo=function(n){'use strict';if(this._animating)return;var o=this._items.length;if(0<=n&&n<o||!this._config.wrap){var p=(n+o)%o;this._updateArrowState(p);return this._animate(p,c('shield')(this._setCurrent,this,p));}var q=n%o,r=q?o-1:0,s=this._items[o-1];c('Style').set(s,'position','absolute');c('Style').set(s,k,-this._config.width+'px');if(r===0)this._setContainerPos(-1);this._animate(q,function(){c('Style').set(s,'position','static');c('Style').set(s,k,'auto');this._setContainerPos(r);this._setCurrent(r);}.bind(this));};f.exports=m;},null);